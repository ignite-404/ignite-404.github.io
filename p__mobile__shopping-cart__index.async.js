"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5722],{99270:function(se,K,n){n.d(K,{Z:function(){return $}});var Q=n(96180),Z=n(85893);function $(){return(0,Z.jsx)("div",{style:{minHeight:300,display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center"},children:(0,Z.jsx)(Q.c,{size:"sm",color:"default"})})}},80892:function(se,K,n){var Q=n(97857),Z=n.n(Q),$=n(22897),G=n(63920),ae=n(97975),T=n(85893);K.Z=function(W){var X=W.value,L=W.step,H=W.onChange,_=W.min,ee=W.max,z=W.disabled,c=W.style,R=W.buttonProps,m=X||0,V=L||1,Y=ee||99999999999999,J=_||-Y,ne=function(w){w<J||w>Y||H&&H(w)};return(0,T.jsx)(T.Fragment,{children:(0,T.jsxs)("div",{style:c,className:"flex-row-left flex-nowrap gap-2",children:[(0,T.jsx)($.A,Z()(Z()({isIconOnly:!0,color:"default",size:"sm",isDisabled:z||m<=J,variant:"flat",radius:"full",onPress:function(){ne(m-V)}},R),{},{children:(0,T.jsx)(G.Z,{stroke:1})})),(0,T.jsx)("span",{className:"text-caption text-black text-medium",children:X||0}),(0,T.jsx)($.A,Z()(Z()({isIconOnly:!0,color:"default",size:"sm",isDisabled:z||m>=Y,variant:"flat",radius:"full",onPress:function(){ne(m+V)}},R),{},{children:(0,T.jsx)(ae.Z,{stroke:1})}))]})})}},31682:function(se,K,n){n.r(K),n.d(K,{default:function(){return qe}});var Q=n(19632),Z=n.n(Q),$=n(5574),G=n.n($),ae=n(84179),T=n(68421),W=n(65885),X=n(26774),L=n(67294),H=n(72640),_=n(21274),ee=n(37085),z=n(38295),c=n(35291),R=n(30699),m=n(95813),V=n(45671),Y=n(15009),J=n.n(Y),ne=n(99289),re=n.n(ne),w=n(97857),v=n.n(w),te=n(78957),oe=n(95564),ue=n(85134),de=n(68002),ie=n(15141),b=n(22897),ce=n(77249),Se=n(76021),ye=n(34925),e=n(85893),Ce=function(l){var r=l.model,a=l.onChange;return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("div",{className:"flex-col-top gap-1 w-full",children:(0,e.jsx)("div",{className:"py-1",children:(0,e.jsx)(ye.Y,{label:"\u5907\u6CE8",rows:1,fullWidth:!0,variant:"bordered",value:r.Remark||"",onChange:function(h){a(v()(v()({},r),{},{Remark:h.target.value}))}})})})})},D=n(46629),Ee=n(39951),U=n(18266);function Ie(l){var r,a=l.value,s=l.onSelected,h=l.order,y=(0,T.Z)(R.x1.mall.couponBestCoupon,{manual:!0,onSuccess:function(t,p){(0,m._y)(t,function(){})}}),g=((r=y.data)===null||r===void 0||(r=r.data)===null||r===void 0?void 0:r.Data)||[],P=g.find(function(i){return i.Id==a});(0,L.useEffect)(function(){h?y.run(v()({},h)):y.mutate(void 0)},[h]);var A=function(t){var p,j;return(0,e.jsxs)("div",{className:"flex flex-row items-center justify-start gap-1",children:[(0,e.jsx)("b",{children:((p=t.Coupon)===null||p===void 0?void 0:p.Name)||"--"}),(0,e.jsx)("span",{className:"text-red-500",children:(0,m.lb)(((j=t.Coupon)===null||j===void 0?void 0:j.Price)||0)}),(0,m.Wq)(t.ExpiredAt)||(0,e.jsx)("span",{className:"text-sm text-slate-400",children:"\u8FC7\u671F\uFF1A".concat((0,D.Gl)(t.ExpiredAt))})]})},o=function(){var t=["\u4E0D\u4F7F\u7528\u4F18\u60E0\u5238"];return g.length<=0&&t.push("\u6682\u65E0\u53EF\u7528"),(0,e.jsx)(Ee.g,{items:g,label:"\u4F18\u60E0\u5238",variant:"bordered",isMultiline:!1,isLoading:y.loading,isDisabled:g.length<=0||y.loading,selectedKeys:P!=null&&P.Id?[P.Id.toString()]:[],onSelectionChange:function(j){if(j=="all")alert(j);else{var N=Z()(j).at(0),C=g.find(function(d){var u;return((u=d.Id)===null||u===void 0?void 0:u.toString())==(N==null?void 0:N.toString())});console.log("on-change",j,C),s&&s(C)}},placeholder:t.join(" "),renderValue:function(j){console.log("render-value",j);var N=j.map(function(C){return C.data||{}});return N.length<=0?(0,e.jsx)("span",{className:"text-slate-400",children:t.join(" ")}):N.map(function(C,d){return(0,e.jsx)("div",{children:A(C)},d)})},children:function(j){return(0,e.jsx)(U.R,{children:A(j)},(j.Id||-1).toString())}})};return(0,e.jsxs)("div",{className:"py-2",children:[(0,e.jsx)("div",{children:o()}),(a||0)>0&&(0,e.jsx)("p",{className:"text-overline my-1 cursor-pointer",onClick:function(){s&&s(void 0)},children:"\u4E0D\u4F7F\u7528\u4F18\u60E0\u5238"})]})}var ve=n(61543),fe=n(94442),De=n(66386),Pe=n(37087),Fe=n(55932),Ne=n(48741),Me=function(l){var r,a=l.holder,s=l.model,h=l.onChange,y=l.loading,g=(a==null||(r=a.Order)===null||r===void 0?void 0:r.Items)||[];if(y&&(0,m.G5)(g))return(0,e.jsx)(De.Z,{});if((0,m.G5)(g))return(0,e.jsx)("h3",{children:"\u8BF7\u9009\u62E9\u5546\u54C1"});var P=function(o){var i,t,p,j,N,C,d=o.Sku;if(!d)return(0,e.jsx)("p",{children:"\u5546\u54C1\u4FE1\u606F\u7F3A\u5931"});var u=((i=a.SkuErrors)===null||i===void 0||(i=i.find(function(S){return S.Id==d.Id}))===null||i===void 0?void 0:i.ErrorList)||[],x=(t=d.PriceModel)===null||t===void 0?void 0:t.DiscountModel,E=(p=d.PriceModel)===null||p===void 0?void 0:p.GradePriceModel,M=(0,c.zH)(((j=d.Goods)===null||j===void 0?void 0:j.GoodsPictures)||[],d.Id).at(0),B=(0,Fe.Kk)(M==null?void 0:M.StorageMeta,{width:200}),I=(N=s.Items)===null||N===void 0?void 0:N.find(function(S){return S.SkuId==d.Id});return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"flex-start",justifyContent:"flex-start"},children:[(0,e.jsx)("div",{style:{width:"50px"},children:(0,e.jsx)(fe.Z,{rate:1,src:B||ve.Z,className:"object-cover",width:"100%",alt:""})}),(0,e.jsx)("div",{className:"ml-1 flex-grow",children:(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"flex-start",justifyContent:"space-between"},children:[(0,e.jsxs)("div",{className:"mx-1 flex-grow",children:[(0,e.jsx)("div",{className:"text-caption",children:(0,c.CQ)(d)}),(0,e.jsx)(Ne.Y,{className:"m-0 border-0 p-0",size:"sm",placeholder:"\u5907\u6CE8\u6B64\u5546\u54C1",fullWidth:!0,value:(I==null?void 0:I.Remark)||"",onChange:function(f){var F=Z()(s.Items||[]);F=F.filter(function(O){return O.SkuId!=d.Id}),F=[].concat(Z()(F),[v()(v()({},I),{},{SkuId:d.Id,Remark:f.target.value})]),h(v()(v()({},s),{},{Items:F}))}}),u.map(function(S,f){return(0,e.jsx)("div",{className:"text-caption text-red-500",children:S},f)})]}),(0,e.jsxs)("div",{style:{display:"inline-block"},children:[(0,e.jsx)("div",{children:(0,e.jsx)(Pe.Z,{model:d})}),x!=null&&(0,e.jsx)("div",{className:"text-caption",children:"\u201C".concat(x.Name,"\u201D\u4F18\u60E0,").concat((x.DiscountPercentage||0)*10,"\u6298")}),E!=null&&(E.PriceOffset||0)!=0&&(0,e.jsx)("div",{className:"text-caption",children:"\u201C".concat((C=E.Grade)===null||C===void 0?void 0:C.Name,"\u201D\uFF0C\u5DEE\u4EF7").concat((0,m.lb)(E.PriceOffset||0))}),(0,e.jsx)("div",{className:"text-caption",children:"x".concat(o.Quantity||0)})]})]})})]})})};return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(te.Z,{direction:"vertical",split:(0,e.jsx)(ie.j,{orientation:"horizontal"}),style:{width:"100%"},children:g.map(function(A,o){return(0,e.jsx)("div",{className:"my-1",children:P(A)},o)})})})},me=n(45595),Ae=function(l){var r=l.model,a=l.onChange,s=r.PaymentMethodId==c.XL.Online,h=r.PaymentMethodId==c.XL.Offline,y=r.ShippingMethodId==c.sx.Pickup,g=(0,e.jsx)(ce.Z,{stroke:1,color:"green"}),P=function(){var o=[];return y||o.push(c.XL.Offline),o};return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(me.X,{variant:"flat",topContent:"\u8BF7\u9009\u62E9\u652F\u4ED8\u65B9\u5F0F",disabledKeys:P(),children:[(0,e.jsx)(U.R,{endContent:s&&g,onClick:function(){a(v()(v()({},r),{},{PaymentMethodId:c.XL.Online}))},children:"\u5728\u7EBF\u652F\u4ED8"},c.XL.Online),(0,e.jsx)(U.R,{endContent:h&&g,description:y||"\u5F53\u524D\u914D\u9001\u65B9\u5F0F\u4E0D\u652F\u6301\u8D27\u5230\u4ED8\u6B3E",onClick:function(){a(v()(v()({},r),{},{PaymentMethodId:c.XL.Offline}))},children:"\u8D27\u5230\u4ED8\u6B3E"},c.XL.Offline)]})})},Oe=function(l){var r,a=l.model,s=l.data,h=a.Order;if(!h)return null;var y=h.PromotionPriceOffset||0,g=h.CouponPrice||0,P=h.ShippingFee||0,A=(r=h.OrderCouponRecords)===null||r===void 0?void 0:r.map(function(o){var i;return((i=o.Coupon)===null||i===void 0?void 0:i.Name)||""}).filter(function(o){return!(0,m.Wq)(o)}).join(",");return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(me.X,{variant:"light",topContent:"\u8BA2\u5355\u91D1\u989D",children:[(0,e.jsx)(U.R,{hidden:y==0,endContent:(0,m.lb)(y),children:"\u6D3B\u52A8\u4EF7"},"promotion-price"),(0,e.jsx)(U.R,{hidden:g==0,description:A||void 0,endContent:(0,m.lb)(g),children:"\u4F18\u60E0\u5238"},"coupon-price"),(0,e.jsx)(U.R,{hidden:s.ShippingMethodId==c.sx.Pickup,endContent:(0,m.lb)(P),children:"\u914D\u9001\u8D39"},"shipping-fee"),(0,e.jsx)(U.R,{endContent:(0,e.jsx)("span",{className:"text-sm text-red-500",children:(0,m.lb)(h.TotalPrice||0)}),children:"\u6700\u7EC8\u4EF7\u683C"},"final-price")]})})},he=n(99270),Te=n(77373),Be=n(38214),Ze=n(29505),Le=n(74911),xe=function(l){var r=l.datalist,a=l.onSelect,s=r.flatMap(function(o){return o.TimeRanges||[]}).map(function(o){var i,t;return v()(v()({},o),{},{start:((i=(0,D.QW)(o.StartTime))===null||i===void 0?void 0:i.add(D.Mg,"hour"))||void 0,end:((t=(0,D.QW)(o.EndTime))===null||t===void 0?void 0:t.add(D.Mg,"hour"))||void 0})}),h=(0,D.ND)().add(1e3,"year"),y=(0,Le.Z)(s,function(o){return(o.start||h).format(D.vc)}),g=Object.keys(y).sort(function(o,i){var t,p;return(((t=(0,D.QW)(o))===null||t===void 0?void 0:t.unix())||0)-(((p=(0,D.QW)(i))===null||p===void 0?void 0:p.unix())||0)}),P=function(i){return i.start&&i.end?(0,e.jsx)("div",{className:"mb-1",children:(0,e.jsxs)(b.A,{variant:"bordered",fullWidth:!0,onPress:function(){i.start&&i.end&&a(i.start,i.end)},children:[i.start.format(D.bF)," ~"," ",i.end.format(D.bF)]})}):null},A=function(i){var t=y[i];return!t||t.length<=0?(0,e.jsx)(H.Z,{}):t.map(function(p,j){return(0,e.jsx)("div",{children:P(p)},j)})};return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(Be.n,{isVertical:!0,destroyInactiveTabPanel:!0,variant:"underlined",children:[1,2,3,4,5,6,7].map(function(o,i){var t=(0,D.ND)().utc().add(D.Mg,"hour").add(o,"day"),p=t.format(D.vc);return(0,e.jsx)(Ze.r,{className:"w-full",title:(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[(0,e.jsx)("div",{className:"text-blue-500",children:p}),(0,e.jsx)("div",{className:"text-sm text-slate-400",children:t.format(D.On)})]}),children:A(t.format(D.vc))},"".concat(i))})})})},Re=function(l){var r,a,s=l.model,h=l.onChange,y=s.ShippingMethodId==c.sx.Delivery&&s.DeliveryType==c.lF.ShortDistanceDelivery,g=s.ShippingMethodId==c.sx.Pickup,P=g||y,A=(0,L.useState)(!1),o=G()(A,2),i=o[0],t=o[1],p=(0,T.Z)(R.x1.mall.deliveryGetServiceTime,{manual:!0}),j=(0,T.Z)(R.x1.mall.pickupGetServiceTime,{manual:!0});(0,L.useEffect)(function(){i&&(g&&j.run(),y&&p.run())},[i]);var N=(r=(0,D.QW)(s.PreferDeliveryStartTime))===null||r===void 0?void 0:r.add(D.Mg,"hour"),C=(a=(0,D.QW)(s.PreferDeliveryEndTime))===null||a===void 0?void 0:a.add(D.Mg,"hour"),d=function(){return!N&&!C?(0,e.jsx)("span",{children:"\u9009\u62E9\u4EA4\u4ED8\u65F6\u95F4"}):(0,e.jsx)("span",{children:"".concat((N==null?void 0:N.format(D.Kt))||"?"," ~ ").concat((C==null?void 0:C.format(D.Kt))||"?")})},u=function(){var M;return y?p.loading?(0,e.jsx)(he.Z,{}):(0,e.jsx)(xe,{datalist:((M=p.data)===null||M===void 0||(M=M.data)===null||M===void 0?void 0:M.Data)||[],onSelect:function(I,S){var f,F;t(!1),h(v()(v()({},s),{},{PreferDeliveryStartTime:I==null||(f=I.add(-D.Mg,"hour"))===null||f===void 0?void 0:f.format(D.dq),PreferDeliveryEndTime:S==null||(F=S.add(-D.Mg,"hour"))===null||F===void 0?void 0:F.format(D.dq)}))}}):null},x=function(){var M;return g?j.loading?(0,e.jsx)(he.Z,{}):(0,e.jsx)(xe,{datalist:((M=j.data)===null||M===void 0||(M=M.data)===null||M===void 0?void 0:M.Data)||[],onSelect:function(I,S){var f,F;t(!1),h(v()(v()({},s),{},{PreferDeliveryStartTime:I==null||(f=I.add(-D.Mg,"hour"))===null||f===void 0?void 0:f.format(D.dq),PreferDeliveryEndTime:S==null||(F=S.add(-D.Mg,"hour"))===null||F===void 0?void 0:F.format(D.dq)}))}}):null};return!P||g?null:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(oe.Z,{open:i,onClose:function(){return t(!1)},title:"\u9009\u62E9\u4EA4\u4ED8\u65F6\u95F4",showCloseButton:!0,children:(0,e.jsxs)("div",{className:"py-2",children:[u(),x()]})}),(0,e.jsxs)("div",{className:"flex-row-left w-full gap-1",children:[(0,e.jsx)(b.A,{variant:"bordered",fullWidth:!0,onPress:function(){t(!0)},children:d()}),(N!=null||C!=null)&&(0,e.jsx)(b.A,{color:"danger",startContent:(0,e.jsx)(Te.Z,{stroke:1}),onPress:function(){h(v()(v()({},s),{},{PreferDeliveryStartTime:void 0,PreferDeliveryEndTime:void 0}))},children:"\u4E0D\u9650\u65F6\u95F4"})]})]})},ke=n(47003),We=n(70781),be=n(77072),le=n(63070),Ge=n(35195),Ue=n(27407),Ke=n(25606);function $e(l){var r,a=l.model,s=l.value,h=l.onSelectedAddress,y=(0,T.Z)(R.x1.platform.userAddressList,{manual:!0}),g=((r=y.data)===null||r===void 0||(r=r.data)===null||r===void 0?void 0:r.Data)||[],P=y.loading,A=(0,L.useState)(!1),o=G()(A,2),i=o[0],t=o[1],p=(0,L.useState)(void 0),j=G()(p,2),N=j[0],C=j[1],d=g.find(function(x){return x.Id==s});(0,L.useEffect)(function(){y.run()},[]),(0,L.useEffect)(function(){a.ShippingMethodId==c.sx.Delivery&&a.DeliveryType==c.lF.ShortDistanceDelivery?d!=null&&d.Lat&&d!==null&&d!==void 0&&d.Lon&&R.x1.mall.storeGetDistanceToStore({Lat:d==null?void 0:d.Lat,Lon:d==null?void 0:d.Lon}).then(function(x){C(x.data.Data||void 0)}):C(void 0)},[d==null?void 0:d.Lat,d==null?void 0:d.Lon,a.ShippingMethodId,a.DeliveryType]),(0,L.useEffect)(function(){if(!(g.length<=0)&&!g.some(function(E){return E.Id==s})){var x=(0,Ge.Z)(g,function(E){return-(E.IsDefault?1:0)}).at(0);h&&h(x)}},[s,g]);var u=function(){return P?(0,e.jsx)(_.Z,{}):d==null?(0,e.jsx)(b.A,{fullWidth:!0,startContent:(0,e.jsx)(le.Z,{stroke:1}),variant:"bordered",size:"lg",children:"\u9009\u62E9\u6536\u8D27\u5730\u5740"}):(0,e.jsx)(Ke.Z,{item:d,distance:N,hideEditButton:!0})};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(oe.Z,{showCloseButton:!0,title:"\u9009\u62E9\u6536\u4EF6\u5730\u5740",open:i,onClose:function(){t(!1)},bodyStyle:{backgroundColor:ue.vc.color.gray},children:(0,e.jsx)(Ue.Z,{header:(0,e.jsx)("span",{children:"\u9009\u62E9\u6216\u8005\u4FEE\u6539\u6536\u8D27\u5730\u5740"}),addressList:g,onClick:function(E){h&&h(E),t(!1)},onRefresh:function(){y.run({})},itemStyle:{cursor:"pointer"}})}),(0,e.jsx)("div",{style:{cursor:"pointer"},onClick:function(){t(!0)},children:u()})]})}var pe=n(90845),ze=n(24862),ge=n(19314),Qe=n(22181),Xe=function(){var l=(0,z.o)(),r=l.currentStore;return r?(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(pe.w,{children:[(0,e.jsx)(ze.u,{children:"\u81EA\u63D0\u70B9"}),(0,e.jsx)(ge.G,{children:(0,e.jsxs)("div",{className:"flex-row-left",children:[(0,e.jsx)(le.Z,{stroke:1}),(0,e.jsxs)("div",{className:"ml-1 flex-grow",children:[(0,e.jsx)("div",{children:r.Name}),(0,e.jsx)("div",{className:"text-slate-400",children:r.AddressDetail})]})]})})]})}):(0,e.jsx)(Qe.ZP,{title:"\u8BF7\u9009\u62E9\u4E0B\u5355\u95E8\u5E97"})},He=function(l){var r=l.model,a=l.onChange,s=r.ShippingMethodId==c.sx.Pickup,h=r.ShippingMethodId==c.sx.Delivery,y=r.DeliveryType==c.lF.Express,g=r.DeliveryType==c.lF.ShortDistanceDelivery,P=function(){return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(ke.g,{fullWidth:!0,children:[(0,e.jsx)(b.A,{startContent:(0,e.jsx)(We.Z,{stroke:1}),variant:"bordered",color:h&&y?"primary":"default",onPress:function(){if(r.PaymentMethodId!=c.XL.Online){var i;(i=m.iI.message)===null||i===void 0||i.warning("\u5F53\u524D\u4EA4\u4ED8\u65B9\u5F0F\u53EA\u652F\u6301\u5728\u7EBF\u652F\u4ED8\uFF0C\u5DF2\u4E3A\u60A8\u66F4\u6539")}a(v()(v()({},r),{},{ShippingMethodId:c.sx.Delivery,DeliveryType:c.lF.Express,PaymentMethodId:c.XL.Online,PreferDeliveryStartTime:void 0,PreferDeliveryEndTime:void 0}))},children:"\u7269\u6D41"}),(0,e.jsx)(b.A,{startContent:(0,e.jsx)(be.Z,{stroke:1}),variant:"bordered",color:h&&g?"primary":"default",onPress:function(){if(r.PaymentMethodId!=c.XL.Online){var i;(i=m.iI.message)===null||i===void 0||i.warning("\u5F53\u524D\u4EA4\u4ED8\u65B9\u5F0F\u53EA\u652F\u6301\u5728\u7EBF\u652F\u4ED8\uFF0C\u5DF2\u4E3A\u60A8\u66F4\u6539")}a(v()(v()({},r),{},{ShippingMethodId:c.sx.Delivery,DeliveryType:c.lF.ShortDistanceDelivery,PaymentMethodId:c.XL.Online,PreferDeliveryStartTime:void 0,PreferDeliveryEndTime:void 0}))},children:"\u914D\u9001"}),(0,e.jsx)(b.A,{startContent:(0,e.jsx)(le.Z,{stroke:1}),variant:"bordered",color:s?"primary":"default",onPress:function(){a(v()(v()({},r),{},{ShippingMethodId:c.sx.Pickup,DeliveryType:void 0,PreferDeliveryStartTime:void 0,PreferDeliveryEndTime:void 0}))},children:"\u81EA\u63D0"})]})})};return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"flex-col-top gap-1 w-full",children:[(0,e.jsx)("div",{style:{paddingBottom:8},children:P()}),r.ShippingMethodId==c.sx.Pickup||(0,e.jsx)($e,{model:r,value:r.AddressId,onSelectedAddress:function(o){console.log("address-select",o),a(v()(v()({},r),{},{AddressId:o==null?void 0:o.Id}))}}),r.ShippingMethodId==c.sx.Pickup&&(0,e.jsx)(Xe,{})]})})},je={ShippingMethodId:c.sx.Delivery,DeliveryType:c.lF.Express,PaymentMethodId:c.XL.Online},Ve=function(l){var r,a,s=l.selectedItems,h=(0,z.o)(),y=(0,L.useState)(!1),g=G()(y,2),P=g[0],A=g[1],o=(0,L.useState)(je),i=G()(o,2),t=i[0],p=i[1];(0,L.useEffect)(function(){P&&p(v()({},je))},[P]);var j=s.map(function(S){var f,F=(f=t.Items)===null||f===void 0?void 0:f.find(function(O){return O.SkuId==S.SkuId});return{SkuId:S.SkuId,Quantity:S.Quantity,Remark:(F==null?void 0:F.Remark)||void 0,ValueAddedItemIds:(F==null?void 0:F.ValueAddedItemIds)||void 0}}),N=(0,T.Z)(R.x1.mall.orderPrePlaceOrderWithoutSaving,{manual:!0,onSuccess:function(f,F){(0,m._y)(f,function(){})},onError:function(f){console.log(f),N.mutate(void 0)}}),C=((r=N.data)===null||r===void 0||(r=r.data)===null||r===void 0?void 0:r.Data)||{},d=[].concat(Z()(C.SkuErrors||[]),Z()(C.CouponErrors||[]),Z()(C.PaymentErrors||[]),Z()(C.ShippingErrors||[]),Z()(C.ErrorList||[])),u=(0,T.Z)(R.x1.mall.orderPrePlaceOrderWithoutSaving,{manual:!0,onSuccess:function(f,F){(0,m._y)(f,function(){})},onError:function(f){console.log(f),u.mutate(void 0)}}),x=function(){var S=re()(J()().mark(function f(){return J()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(!(0,m.G5)(j)){O.next=3;break}return alert("\u8BF7\u9009\u62E9\u5546\u54C1"),O.abrupt("return");case 3:return O.next=5,R.x1.mall.orderPlaceOrder(v()(v()({},t),{},{Items:j,PlatformId:"H5"}));case 5:return O.abrupt("return",O.sent);case 6:case"end":return O.stop()}},f)}));return function(){return S.apply(this,arguments)}}(),E=(0,T.Z)(x,{manual:!0,onSuccess:function(f){f&&(0,m._y)(f,function(){(0,m.cQ)("\u4E0B\u5355\u6210\u529F"),console.log("\u4E0B\u5355\u6210\u529F",f.data),setTimeout(function(){h.queryShoppingCartCount(),Se.m8.push({pathname:"/order"})},1e3)})}}),M=E.loading||N.loading||u.loading,B=function(f){return M||(0,m.G5)(f)?null:(0,e.jsx)(de.z,{className:"w-full",color:"danger",size:"sm",radius:"none",children:f==null?void 0:f.map(function(F,O){return(0,e.jsx)("div",{children:"".concat(O+1,". ").concat(F)},O)})})};if((0,L.useEffect)(function(){if(P&&!(j.length<=0)&&!((0,m.Wq)(t.AddressId)&&t.ShippingMethodId==c.sx.Delivery)){var S=v()(v()({},t),{},{Items:j,PlatformId:"H5"});N.run(S),u.run(v()(v()({},S),{},{UserCouponId:void 0}))}},[t.AddressId,t.DeliveryType,t.UserCouponId,t.ShippingMethodId,s,P]),(a=h.mallSettings)!==null&&a!==void 0&&(a=a.OrderSettings)!==null&&a!==void 0&&a.PlaceOrderDisabled)return(0,e.jsx)(de.z,{color:"warning",children:"\u7BA1\u7406\u5458\u5173\u95ED\u4E86\u4E0B\u5355\u529F\u80FD"});var I=function(){var f,F,O;return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(te.Z,{direction:"vertical",style:{width:"100%",marginBottom:24,paddingTop:16},children:[(0,m.Wq)((f=h.mallSettings)===null||f===void 0?void 0:f.PlaceOrderNotice)||(0,e.jsx)(de.z,{children:(F=h.mallSettings)===null||F===void 0?void 0:F.PlaceOrderNotice}),(0,e.jsxs)(te.Z,{direction:"horizontal",style:{paddingBottom:16},children:[(0,e.jsx)("span",{className:"text-caption",children:"\u4E0B\u5355\u95E8\u5E97"}),(0,e.jsx)(ee.Z,{})]}),(0,e.jsx)(He,{model:t,onChange:function(k){p(v()({},k))}}),B(C.ShippingErrors),(0,e.jsx)(ie.j,{orientation:"horizontal"}),(0,e.jsx)(Me,{loading:N.loading,holder:C,model:t,onChange:function(k){console.log(k),p(v()({},k))}}),(0,e.jsx)(Ce,{model:t,onChange:function(k){return p(v()({},k))}}),(0,e.jsx)(Ie,{order:(O=u.data)===null||O===void 0||(O=O.data)===null||O===void 0||(O=O.Data)===null||O===void 0?void 0:O.Order,value:t.UserCouponId,onSelected:function(k){p(v()(v()({},t),{},{UserCouponId:(k==null?void 0:k.Id)||void 0}))}}),B(C.CouponErrors),(0,e.jsx)(Re,{model:t,onChange:function(k){p(v()({},k))}}),(0,e.jsx)(Ae,{model:t,onChange:function(k){p(v()({},k))}}),B(C.PaymentErrors),(0,e.jsx)(ie.j,{orientation:"horizontal"}),(0,e.jsx)(Oe,{model:C,data:t})]})})};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(b.A,{color:"warning",variant:"solid",isDisabled:(0,m.G5)(j),onPress:function(){A(!0)},children:"\u7ACB\u5373\u4E0B\u5355"}),(0,e.jsxs)(oe.Z,{showCloseButton:!0,title:"\u8D2D\u7269\u8F66\u4E0B\u5355",open:P,onClose:function(){A(!1)},bodyStyle:{backgroundColor:ue.vc.color.gray},children:[I(),(0,e.jsx)(ie.j,{orientation:"horizontal"}),(0,e.jsxs)(te.Z,{direction:"vertical",style:{width:"100%",marginTop:8,marginBottom:8},children:[d.length>0&&(0,e.jsx)("div",{className:"text-caption text-red-500",children:"\u8BF7\u5148\u4FEE\u6B63\u63D0\u4EA4\u9519\u8BEF"}),B(C.ErrorList),(0,e.jsx)(b.A,{isLoading:M,fullWidth:!0,color:"warning",startContent:(0,e.jsx)(ce.Z,{stroke:1}),isDisabled:d.length>0,onPress:function(){E.run()},children:"\u786E\u8BA4\u4E0B\u5355"})]})]})]})},Ye=n(80892),Je=n(74715);function we(l){var r,a=l.model,s=l.onSelect,h=l.checked,y=l.onUpdate,g=(0,c.Jd)(a.Sku||{},{width:200,height:200}),P=(0,c.Er)(a.Sku),A=Math.min((0,c.GK)(a.Sku),((r=a.Sku)===null||r===void 0||(r=r.StockModel)===null||r===void 0?void 0:r.StockQuantity)||0),o=(0,T.Z)(R.x1.mall.shoppingCartRemoveItem,{manual:!0,onSuccess:function(u,x){(0,m._y)(u,function(){y()})}}),i=function(){confirm("\u786E\u5B9A\u5220\u9664\uFF1F")&&o.run({Id:a.Id})},t=(0,T.Z)(R.x1.mall.shoppingCartUpdateCartItem,{manual:!0,onSuccess:function(u,x){(0,m._y)(u,function(){y()})}}),p=t.loading||o.loading,j=function(){var u;return(0,m.G5)(a.Waring)?null:(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("div",{className:"my-1 p-1",style:{backgroundColor:"rgb(250,250,250)"},children:(u=a.Waring)===null||u===void 0?void 0:u.map(function(x,E){return(0,e.jsx)("div",{className:"text-caption mb-1",children:x},E)})})})},N=function(){return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"mb-1 mr-1",children:(0,e.jsx)(Je.Z,{model:a.Sku||{}})}),(0,e.jsx)("div",{className:"flex flex-row items-center justify-end gap-1",children:(0,e.jsx)(Ye.Z,{value:a.Quantity||1,min:P,max:A,disabled:P>A||p,onChange:function(x){x<=P?confirm("\u5220\u9664\uFF1F")&&i():t.run({Id:a.Id,Quantity:x})}})})]})},C=function(){var u;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"mb-1",children:(0,e.jsx)(V.K,{isSelected:h,onChange:function(E){s&&s(a.Id||0,E.target.checked)},isDisabled:!(0,m.G5)(a.Waring),children:((u=a.Sku)===null||u===void 0||(u=u.Goods)===null||u===void 0?void 0:u.Name)||"--"})}),(0,e.jsxs)("div",{className:"flex flex-row items-center justify-start",children:[(0,e.jsx)("div",{style:{width:"70px"},children:(0,e.jsx)(fe.Z,{rate:1,src:g||ve.Z,className:"object-cover",width:"100%",alt:""})}),(0,e.jsx)("div",{className:"ml-1 flex-grow",children:N()})]}),j()]})};return(0,c.dB)(a.Sku)?(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(pe.w,{shadow:"sm",radius:"sm",className:"mb-2",children:(0,e.jsx)(ge.G,{children:C()})})}):(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("div",{className:"bg-slate-100 border-1 border-dashed border-slate-200 p-2 mb-2",children:(0,e.jsxs)("div",{className:"flex-row-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"text-overline",children:"\u60A8\u6B64\u524D\u6536\u85CF\u7684\u5546\u54C1\u5DF2\u4E0B\u67B6"}),(0,e.jsxs)("div",{className:"text-caption",children:["\u6536\u85CF\u4E8E",(0,D.Gl)(a.CreationTime)]})]}),(0,e.jsx)(b.A,{size:"sm",variant:"flat",color:"danger",isLoading:p,onPress:function(){i()},children:"\u5220\u9664"})]})})})}var qe=function(){var l;(0,ae.Z)("\u8D2D\u7269\u8F66");var r=(0,z.o)(),a=(0,T.Z)(R.x1.mall.shoppingCartListShoppingCarts,{manual:!0,onSuccess:function(x,E){(0,m._y)(x,function(){})}}),s=((l=a.data)===null||l===void 0||(l=l.data)===null||l===void 0?void 0:l.Data)||[],h=(0,W.Z)("shopping-cart.selected.cache",{serializer:function(x){return JSON.stringify(x||[])},deserializer:function(x){return(0,m.Jp)(x)||[]},defaultValue:[]}),y=G()(h,2),g=y[0],P=y[1],A=g||[],o=s.filter(function(u){return(0,c.dB)(u.Sku)&&(0,m.G5)(u.Waring)}),i=o.filter(function(u){return A.indexOf(u.Id||0)>=0}),t=i.map(function(u){return u.Id||0});(0,L.useEffect)(function(){a.run()},[]);var p=function(){if((0,m.G5)(o))return null;var x=o.every(function(E){return t.indexOf(E.Id||0)>=0});return(0,e.jsx)(V.K,{isSelected:x,onChange:function(M){P(function(B){return M.target.checked?o.map(function(I){return I.Id||0}):[]})},children:"\u5168\u9009"})},j=function(){if(i.length<=0)return p();var x=(0,X.Z)(i.map(function(B){var I;return(((I=B.Sku)===null||I===void 0||(I=I.PriceModel)===null||I===void 0?void 0:I.BasePrice)||0)*(B.Quantity||0)})),E=(0,X.Z)(i.map(function(B){var I;return(((I=B.Sku)===null||I===void 0||(I=I.PriceModel)===null||I===void 0?void 0:I.FinalPrice)||0)*(B.Quantity||0)})),M=x-E;return(0,e.jsxs)("div",{children:[(0,e.jsx)("b",{children:i.length}),"\u4E2A\u5546\u54C1\uFF0C\u603B\u8BA1",(0,e.jsx)("b",{children:(0,m.lb)(E)}),"\u3002",M>0&&(0,e.jsxs)("span",{children:["\u4F18\u60E0",(0,e.jsx)("b",{children:(0,m.lb)(M)})]})]})},N=function(){return(0,e.jsxs)("div",{className:"px-1 py-3 flex-row-between",children:[(0,e.jsxs)("div",{className:"flex flex-row items-end justify-start gap-1",children:[(0,e.jsx)("h2",{className:"text-title mb-0",children:"\u8D2D\u7269\u8F66"}),s.length>0&&(0,e.jsxs)("h4",{className:"text-subtitle mb-0",children:["(",s.length,")"]})]}),(0,e.jsx)(ee.Z,{})]})},C=function(){return(0,m.G5)(s)?null:(0,e.jsx)("div",{className:"container max-w-lg",style:{position:"fixed",left:0,right:0,bottom:"".concat(r.bottomHeight+5,"px"),zIndex:10},children:(0,e.jsxs)("div",{className:"flex-row-between mx-1 rounded-md border-2 border-solid border-red-500 bg-white p-1 shadow-md",children:[(0,e.jsx)("div",{children:j()}),(0,e.jsx)(Ve,{selectedItems:i})]})})},d=function(){return a.loading?(0,e.jsx)(_.Z,{}):(0,m.G5)(s)?(0,e.jsx)(H.Z,{}):s==null?void 0:s.map(function(x,E){return(0,e.jsx)("div",{children:(0,e.jsx)(we,{model:x,checked:t.indexOf(x.Id||0)>=0,onUpdate:function(){r.queryShoppingCartCount(),a.run()},onSelect:function(B,I){var S=Z()(t.filter(function(f){return f!=B}));I&&S.push(B),P(S)}})},E)})};return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("div",{className:"container max-w-lg",children:(0,e.jsxs)("div",{className:"mb-3 px-1 py-2",children:[N(),d(),C()]})})})}}}]);
