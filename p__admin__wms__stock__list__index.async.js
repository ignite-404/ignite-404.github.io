"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[326],{96256:function($,T,e){var M=e(97857),a=e.n(M),R=e(19632),o=e.n(R),p=e(5574),x=e.n(p),S=e(85980),m=e(34041),b=e(57381),g=e(67294),c=e(85893);T.Z=function(C){var n=C.onSearch,L=C.value,i=C.onChange,d=C.style,r=C.initItem,I=C.placeholder,_=C.props,j=(0,g.useState)(!1),Q=x()(j,2),z=Q[0],y=Q[1],k=(0,g.useState)([]),X=x()(k,2),Y=X[0],ee=X[1],ne=(0,S.Z)(function(N){y(!0),n(N).then(function(v){ee(v||[])}).finally(function(){return y(!1)})},{wait:500});(0,g.useEffect)(function(){},[]);var te=function(){var v=o()(Y);return r&&!v.find(function(h){return h.value===r.value})&&v.push(r),v};return(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(m.Z,a()({style:a()({minWidth:300},d),loading:z,value:L,showSearch:!0,allowClear:!0,filterOption:!1,onSearch:function(v){ne.run(v)},onChange:function(v){var h=Y.find(function(Z){return Z.value==v});i&&i(h)},onClear:function(){i&&i(void 0)},placeholder:I||"\u8F93\u5165\u5173\u952E\u8BCD",notFoundContent:z&&(0,c.jsx)(b.Z,{size:"small"}),options:te()},_))})}},23806:function($,T,e){var M=e(1288),a=e(85893);T.Z=function(R){var o=R.model,p=R.fallback;if(o==null||o==null)return null;var x=o==null?void 0:o.CreationTime,S=o==null?void 0:o.LastModificationTime;return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{style:{},children:[(0,a.jsx)("div",{children:(0,a.jsx)(M.Z,{prefix:(0,a.jsx)("span",{children:"\u521B\u5EFA\uFF1A"}),onlyDate:!0,timeStr:x,fallback:p})}),(0,a.jsx)("div",{children:(0,a.jsx)(M.Z,{prefix:(0,a.jsx)("span",{children:"\u4FEE\u6539\uFF1A"}),onlyDate:!0,timeStr:S,fallback:p})})]})})}},48746:function($,T,e){var M=e(15009),a=e.n(M),R=e(99289),o=e.n(R),p=e(96256),x=e(35291),S=e(30967),m=e(42838),b=e(85893);T.Z=function(g){var c=g.selectedSku,C=g.onChange,n=g.style,L=g.props,i=function(){var d=o()(a()().mark(function r(I){var _,j,Q;return a()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(!(0,m.Wq)(I)){y.next=2;break}return y.abrupt("return",[]);case 2:return y.next=4,S.x1.mallAdmin.skuQuerySkuForSelection({Keywords:I,Take:20});case 4:return j=y.sent,Q=j==null||(_=j.data)===null||_===void 0||(_=_.Data)===null||_===void 0?void 0:_.map(function(k){return{label:(0,x.CQ)(k)||"--",value:k.Id||"--"}}),y.abrupt("return",Q||[]);case 7:case"end":return y.stop()}},r)}));return function(I){return d.apply(this,arguments)}}();return(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(p.Z,{style:n,props:L,onSearch:function(){var d=o()(a()().mark(function r(I){return a()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.next=2,i(I);case 2:return j.abrupt("return",j.sent);case 3:case"end":return j.stop()}},r)}));return function(r){return d.apply(this,arguments)}}(),placeholder:"\u641C\u7D22\u5546\u54C1...",value:(c==null?void 0:c.Id)||void 0,initItem:c==null?void 0:{label:(0,x.CQ)(c)||"",value:c.Id||""},onChange:function(r){C&&C(r==null?void 0:{Id:r.value,Name:r.label})}})})}},47246:function($,T,e){e.r(T),e.d(T,{default:function(){return N}});var M=e(97857),a=e.n(M),R=e(5574),o=e.n(R),p=e(45360),x=e(66309),S=e(14726),m=e(67294),b=e(23806),g=e(30967),c=e(42838),C=e(57731),n=e(85893),L=function(v){var h=v.data,Z=[{title:"\u5546\u54C1",render:function(F,E){var D,f;return(0,n.jsx)("span",{children:"".concat(((D=E.Goods)===null||D===void 0?void 0:D.Name)||"--","/").concat(((f=E.Sku)===null||f===void 0?void 0:f.Name)||"--")})}},{title:"\u91C7\u8D2D\u5355\u4EF7",render:function(F,E){return(0,n.jsx)("span",{children:E.Price})}},{title:"\u91C7\u8D2D\u6570\u91CF",render:function(F,E){return(0,n.jsx)("span",{children:E.Quantity})}}];return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(C.Z,{options:!1,search:!1,bordered:!0,headerTitle:"\u5E93\u5B58\u6279\u6B21\u660E\u7EC6",columns:Z,dataSource:h||[],pagination:!1})})},i=e(4393),d=e(11346),r=e(25278),I=function(h){var Z=h.query,A=h.onSearch,F=(0,m.useState)({}),E=o()(F,2),D=E[0],f=E[1],P=function(s){s.Page=1,A&&A(s)};return(0,m.useEffect)(function(){f(a()({},Z))},[]),(0,n.jsx)(i.Z,{bordered:!1,style:{marginBottom:10},children:(0,n.jsxs)(d.Z,{layout:"inline",children:[(0,n.jsx)(d.Z.Item,{label:"\u6279\u6B21\u53F7",children:(0,n.jsx)(r.Z,{value:D.SerialNo||"",onChange:function(s){f(function(O){return a()(a()({},O),{},{SerialNo:s.target.value})})}})}),(0,n.jsx)(d.Z.Item,{wrapperCol:{offset:8,span:16},children:(0,n.jsx)(S.ZP,{type:"primary",htmlType:"submit",onClick:function(){P(D)},children:"\u641C\u7D22"})})]})})},_=I,j=e(85576),Q=e(34041),z=e(19632),y=e.n(z),k=e(24435),X=e(80799),Y=e(77953),ee=e(48746),ne=function(v){var h=v.items,Z=v.onChange,A=function(D,f){var P=y()(h);P[D]=f(P[D]),Z(P)},F=[{title:"\u5546\u54C1",width:300,render:function(D,f,P){return(0,n.jsxs)(n.Fragment,{children:[(0,c.Wq)(f.SkuId)&&(0,n.jsx)("div",{style:{fontWeight:"bold",color:"red",marginBottom:5},children:"\u8BF7\u9009\u62E9"}),(0,n.jsx)(ee.Z,{selectedSku:f.Sku||{},onChange:function(s){if(s){if(h.some(function(O,G){return G!=G&&O.SkuId==s.Id})){p.ZP.error("\u5546\u54C1\u5DF2\u7ECF\u5B58\u5728\u4E8E\u91C7\u8D2D\u5355\uFF0C\u8BF7\u91CD\u65B0\u9009\u62E9");return}A(P,function(O){return a()(a()({},O),{},{Sku:s,SkuId:s.Id})})}},style:{width:"100%"}})]})}},{title:"\u6570\u91CF",render:function(D,f,P){return(0,n.jsxs)(n.Fragment,{children:[f.Quantity&&f.Quantity>0||(0,n.jsx)("div",{style:{fontWeight:"bold",color:"red",marginBottom:5},children:"\u8BF7\u8F93\u5165"}),(0,n.jsx)(k.Z,{min:1,value:f.Quantity,onChange:function(s){A(P,function(O){return a()(a()({},O),{},{Quantity:s||0})})}})]})}},{title:"\u8FDB\u8D27\u4EF7",render:function(D,f,P){return(0,n.jsxs)(n.Fragment,{children:[f.Price&&f.Price>0||(0,n.jsx)("div",{style:{fontWeight:"bold",color:"red",marginBottom:5},children:"\u8BF7\u8F93\u5165"}),(0,n.jsx)(k.Z,{min:0,value:f.Price,onChange:function(s){A(P,function(O){return a()(a()({},O),{},{Price:s||0})})}})]})}},{title:"\u64CD\u4F5C",render:function(D,f,P){return(0,n.jsx)(S.ZP,{type:"link",danger:!0,onClick:function(){if(confirm("\u786E\u8BA4\u5220\u9664\uFF1F")){var s=y()(h);(0,Y.Z)(s,P),Z(s)}},children:"\u5220\u9664"})}}];return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(X.Z,{dataSource:h,columns:F,pagination:!1,style:{marginBottom:10}}),(0,n.jsx)(S.ZP,{block:!0,type:"dashed",onClick:function(){Z([].concat(y()(h),[{Quantity:10}]))},children:"\u6DFB\u52A0\u5546\u54C1"})]})},te=function(v){var h=v.show,Z=v.hide,A=v.data,F=v.ok,E=(0,m.useState)(!1),D=o()(E,2),f=D[0],P=D[1],W=(0,m.useState)([]),s=o()(W,2),O=s[0],G=s[1],w=(0,m.useState)([]),H=o()(w,2),J=H[0],ae=H[1],q=(0,m.useState)({}),V=o()(q,2),U=V[0],B=V[1],ue=function(t){return!!(t.SkuId&&t.Quantity&&t.Quantity>0&&t.Price&&t.Price>0)},re=function(t){if(!t.Items||t.Items.length<=0){p.ZP.error("\u8BF7\u6DFB\u52A0\u5546\u54C1");return}if(t.Items.some(function(u){return!ue(u)})){p.ZP.error("\u8BF7\u8F93\u5165\u91C7\u8D2D\u4FE1\u606F");return}P(!0),g.x1.mallAdmin.stockInsertStock(a()({},t)).then(function(u){(0,c._y)(u,function(){p.ZP.success("\u4FDD\u5B58\u6210\u529F"),F()})}).finally(function(){P(!1)})},le=function(){g.x1.mallAdmin.supplierQueryAll({}).then(function(t){(0,c._y)(t,function(){ae(t.data.Data||[])})}),g.x1.mallAdmin.warehouseQueryAll({}).then(function(t){(0,c._y)(t,function(){G(t.data.Data||[])})})};return(0,m.useEffect)(function(){h&&le()},[h]),(0,m.useEffect)(function(){B(a()({},A))},[A]),(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(j.Z,{confirmLoading:f,open:h,onCancel:function(){return Z()},onOk:function(){return re(U)},width:"90%",title:"\u6DFB\u52A0\u91C7\u8D2D\u5355",forceRender:!0,destroyOnClose:!0,children:[(0,n.jsxs)(d.Z,{labelCol:{flex:"110px"},labelAlign:"right",wrapperCol:{flex:1},children:[(0,n.jsx)(d.Z.Item,{label:"\u4F9B\u5E94\u5546",name:"SupplierId",children:(0,n.jsx)(Q.Z,{allowClear:!0,placeholder:"\u8BF7\u9009\u62E9\u4F9B\u8D27\u5546",value:U.SupplierId,onChange:function(t){B(function(u){return a()(a()({},u),{},{SupplierId:t})})},onClear:function(){B(a()(a()({},U),{},{SupplierId:void 0}))},options:J.map(function(l){return{label:l.Name,value:l.Id}})})}),(0,n.jsx)(d.Z.Item,{label:"\u76EE\u6807\u4ED3\u5E93",children:(0,n.jsx)(Q.Z,{allowClear:!0,placeholder:"\u8BF7\u9009\u62E9\u76EE\u6807\u4ED3\u5E93",value:U.WarehouseId,onChange:function(t){B(function(u){return a()(a()({},u),{},{WarehouseId:t})})},onClear:function(){B(a()(a()({},U),{},{WarehouseId:void 0}))},options:O.map(function(l){return{label:l.Name,value:l.Id}})})}),(0,n.jsx)(d.Z.Item,{label:"\u5907\u6CE8",name:"Remark",rules:[{max:500}],children:(0,n.jsx)(r.Z.TextArea,{placeholder:"\u8BF7\u8F93\u5165\u91C7\u8D2D\u5907\u6CE8"})})]}),h&&(0,n.jsx)(ne,{items:U.Items||[],onChange:function(t){B(a()(a()({},U),{},{Items:t}))}})]})})},N=function(){var v=(0,m.useState)(!0),h=o()(v,2),Z=h[0],A=h[1],F=(0,m.useState)({Items:[],TotalCount:0}),E=o()(F,2),D=E[0],f=E[1],P=(0,m.useState)({Page:1}),W=o()(P,2),s=W[0],O=W[1],G=(0,m.useState)(void 0),w=o()(G,2),H=w[0],J=w[1],ae=(0,m.useState)(void 0),q=o()(ae,2),V=q[0],U=q[1],B=function(t){A(!0),g.x1.mallAdmin.stockStockPaging(t).then(function(u){u.data.Error?p.ZP.error(u.data.Error.Message):f(u.data||{})}).finally(function(){A(!1)})},ue=function(t){t.Approved||confirm("\u786E\u5B9A\u6279\u51C6\u91C7\u8D2D\u5355\uFF1F")&&(U(t.Id||""),g.x1.mallAdmin.stockApproveStock({Id:t.Id}).then(function(u){(0,c._y)(u,function(){p.ZP.success("\u5DF2\u7ECF\u6279\u51C6\u91C7\u8D2D"),B(s)})}).finally(function(){U("")}))},re=function(t){confirm("\u5220\u9664\u5165\u5E93\u5355\uFF1F")&&(U(t.Id||""),g.x1.mallAdmin.stockDeleteUnApprovedStock({Id:t.Id}).then(function(u){u.data.Error?p.ZP.error(u.data.Error.Message):(p.ZP.success("\u5220\u9664\u6210\u529F"),B(s))}).finally(function(){U("")}))},le=[{title:"\u6279\u53F7",render:function(t,u){return(0,n.jsx)("b",{children:"".concat(u.No||"--")})}},{title:"\u5907\u6CE8\u4FE1\u606F",render:function(t,u){return u.Remark||"--"}},{title:"\u4ED3\u5E93",render:function(t,u){var K;return(0,n.jsx)("span",{children:((K=u.Warehouse)===null||K===void 0?void 0:K.Name)||"--"})}},{title:"\u4F9B\u8D27\u5546",render:function(t,u){var K;return(0,n.jsx)("span",{children:((K=u.Supplier)===null||K===void 0?void 0:K.Name)||"--"})}},{title:"\u72B6\u6001",render:function(t,u){return u.Approved?(0,n.jsx)(x.Z,{color:"green",children:"\u5DF2\u6279\u51C6"}):(0,n.jsx)(x.Z,{color:"yellow",children:"\u5F85\u5BA1\u6838"})}},{title:"\u65F6\u95F4",render:function(t,u){return(0,n.jsx)(b.Z,{model:u})}},{title:"\u64CD\u4F5C",width:200,render:function(t,u){return(0,n.jsxs)(S.ZP.Group,{children:[u.Approved||(0,n.jsx)(S.ZP,{loading:V==u.Id,type:"primary",onClick:function(){ue(u)},children:"\u5BA1\u6838"}),u.Approved||(0,n.jsx)(S.ZP,{loading:V==u.Id,danger:!0,onClick:function(){re(u)},children:"\u5220\u9664"})]})}}];return(0,m.useEffect)(function(){B(s)},[]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(te,{show:H!=null,hide:function(){return J(void 0)},data:H||{},ok:function(){J(void 0),B(s)}}),(0,n.jsx)(_,{query:s,onSearch:function(t){O(t),B(t)}}),(0,n.jsx)(C.Z,{options:!1,search:!1,headerTitle:"\u91C7\u8D2D\u5355",toolBarRender:function(){return[(0,n.jsx)(S.ZP,{type:"primary",onClick:function(){J({})},children:"\u65B0\u589E"})]},rowKey:function(t){return t.Id||""},loading:Z,columns:le,dataSource:D.Items||[],expandable:{expandedRowRender:function(t){return(0,n.jsx)("div",{style:{padding:10,border:"5px dashed orange"},children:(0,n.jsx)(L,{data:t.Items||[]})})}},pagination:{showSizeChanger:!1,pageSize:20,current:s.Page,total:D.TotalCount,onChange:function(t){var u=a()(a()({},s),{},{Page:t});O(u),B(u)}}})]})}},85980:function($,T,e){var M=e(97582),a=e(23279),R=e.n(a),o=e(67294),p=e(3930),x=e(45210),S=e(92770),m=e(31663);function b(g,c){var C;m.Z&&((0,S.mf)(g)||console.error("useDebounceFn expected parameter is a function, got ".concat(typeof g)));var n=(0,p.Z)(g),L=(C=c==null?void 0:c.wait)!==null&&C!==void 0?C:1e3,i=(0,o.useMemo)(function(){return R()(function(){for(var d=[],r=0;r<arguments.length;r++)d[r]=arguments[r];return n.current.apply(n,(0,M.ev)([],(0,M.CR)(d),!1))},L,c)},[]);return(0,x.Z)(function(){i.cancel()}),{run:i,cancel:i.cancel,flush:i.flush}}T.Z=b},77953:function($,T,e){e.d(T,{Z:function(){return L}});var M=e(74073),a=e(16423);function R(i,d){for(var r=-1,I=d.length,_=Array(I),j=i==null;++r<I;)_[r]=j?void 0:(0,a.Z)(i,d[r]);return _}var o=R,p=e(49344),x=e(56009),S=Array.prototype,m=S.splice;function b(i,d){for(var r=i?d.length:0,I=r-1;r--;){var _=d[r];if(r==I||_!==j){var j=_;(0,x.Z)(_)?m.call(i,_,1):(0,p.Z)(i,_)}}return i}var g=b,c=e(97109),C=e(94008),n=(0,C.Z)(function(i,d){var r=i==null?0:i.length,I=o(i,d);return g(i,(0,M.Z)(d,function(_){return(0,x.Z)(_,r)?+_:_}).sort(c.Z)),I}),L=n}}]);
