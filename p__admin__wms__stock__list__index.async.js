"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[326],{96256:function(V,T,n){var Z=n(97857),r=n.n(Z),v=n(19632),u=n.n(v),_=n(5574),I=n.n(_),x=n(85980),f=n(34041),U=n(57381),j=n(67294),l=n(85893);T.Z=function(E){var e=E.onSearch,Q=E.value,W=E.onChange,C=E.style,p=E.initItem,F=E.placeholder,B=E.props,D=(0,j.useState)(!1),L=I()(D,2),$=L[0],S=L[1],k=(0,j.useState)([]),X=I()(k,2),Y=X[0],ee=X[1],ne=(0,x.Z)(function(N){S(!0),e(N).then(function(d){ee(d||[])}).finally(function(){return S(!1)})},{wait:500});(0,j.useEffect)(function(){},[]);var te=function(){var d=u()(Y);return p&&!d.find(function(c){return c.value===p.value})&&d.push(p),d};return(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(f.Z,r()({style:r()({minWidth:300},C),loading:$,value:Q,showSearch:!0,allowClear:!0,filterOption:!1,onSearch:function(d){ne.run(d)},onChange:function(d){var c=Y.find(function(A){return A.value==d});W&&W(c)},onClear:function(){W&&W(void 0)},placeholder:F||"\u8F93\u5165\u5173\u952E\u8BCD",notFoundContent:$&&(0,l.jsx)(U.Z,{size:"small"}),options:te()},B))})}},23806:function(V,T,n){var Z=n(1288),r=n(85893);T.Z=function(v){var u=v.model,_=v.fallback;if(u==null||u==null)return null;var I=u==null?void 0:u.CreationTime,x=u==null?void 0:u.LastModificationTime;return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{style:{},children:[(0,r.jsx)("div",{children:(0,r.jsx)(Z.Z,{prefix:(0,r.jsx)("span",{children:"\u521B\u5EFA\uFF1A"}),onlyDate:!0,timeStr:I,fallback:_})}),(0,r.jsx)("div",{children:(0,r.jsx)(Z.Z,{prefix:(0,r.jsx)("span",{children:"\u4FEE\u6539\uFF1A"}),onlyDate:!0,timeStr:x,fallback:_})})]})})}},1288:function(V,T,n){var Z=n(78957),r=n(83062),v=n(46629),u=n(85893);T.Z=function(_){var I,x=_.timeStr,f=_.fallback,U=_.onlyDate,j=_.prefix,l=(I=(0,v.mg)(x))===null||I===void 0?void 0:I.add(v.Mg,"hour");if(!l)return f||null;var E=(0,v.ND)().utc().add(v.Mg,"hour"),e=l.isSame(E,"year"),Q=l.diff(E,"day"),W=e?l.format(v.AK):l.format(v.vc),C=function(){return(0,u.jsxs)("div",{children:[(0,u.jsxs)(Z.Z,{direction:"horizontal",children:[(0,u.jsx)("div",{children:l.fromNow()}),(0,u.jsx)("div",{children:l.format(v.On)})]}),(0,u.jsx)("div",{children:l.format(v.t9)})]})};return(0,u.jsx)(r.Z,{title:C(),children:(0,u.jsxs)(Z.Z,{direction:"horizontal",children:[j,(0,u.jsx)("div",{className:"inline-block cursor-pointer hover:bg-orange-500",children:U?l.format(v.vc):l.format(v.dq)})]})})}},48746:function(V,T,n){var Z=n(15009),r=n.n(Z),v=n(99289),u=n.n(v),_=n(96256),I=n(35291),x=n(30699),f=n(66419),U=n(85893);T.Z=function(j){var l=j.selectedSku,E=j.onChange,e=j.style,Q=j.props,W=function(){var C=u()(r()().mark(function p(F){var B,D,L;return r()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(!(0,f.Wq)(F)){S.next=2;break}return S.abrupt("return",[]);case 2:return S.next=4,x.x1.mallAdmin.skuQuerySkuForSelection({Keywords:F,Take:20});case 4:return D=S.sent,L=D==null||(B=D.data)===null||B===void 0||(B=B.Data)===null||B===void 0?void 0:B.map(function(k){return{label:(0,I.CQ)(k)||"--",value:k.Id||"--"}}),S.abrupt("return",L||[]);case 7:case"end":return S.stop()}},p)}));return function(F){return C.apply(this,arguments)}}();return(0,U.jsx)(U.Fragment,{children:(0,U.jsx)(_.Z,{style:e,props:Q,onSearch:function(){var C=u()(r()().mark(function p(F){return r()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return D.next=2,W(F);case 2:return D.abrupt("return",D.sent);case 3:case"end":return D.stop()}},p)}));return function(p){return C.apply(this,arguments)}}(),placeholder:"\u641C\u7D22\u5546\u54C1...",value:(l==null?void 0:l.Id)||void 0,initItem:l==null?void 0:{label:(0,I.CQ)(l)||"",value:l.Id||""},onChange:function(p){E&&E(p==null?void 0:{Id:p.value,Name:p.label})}})})}},47246:function(V,T,n){n.r(T),n.d(T,{default:function(){return N}});var Z=n(97857),r=n.n(Z),v=n(5574),u=n.n(v),_=n(45360),I=n(66309),x=n(14726),f=n(67294),U=n(23806),j=n(30699),l=n(66419),E=n(57731),e=n(85893),Q=function(d){var c=d.data,A=[{title:"\u5546\u54C1",render:function(R,m){var h,i;return(0,e.jsx)("span",{children:"".concat(((h=m.Goods)===null||h===void 0?void 0:h.Name)||"--","/").concat(((i=m.Sku)===null||i===void 0?void 0:i.Name)||"--")})}},{title:"\u91C7\u8D2D\u5355\u4EF7",render:function(R,m){return(0,e.jsx)("span",{children:m.Price})}},{title:"\u91C7\u8D2D\u6570\u91CF",render:function(R,m){return(0,e.jsx)("span",{children:m.Quantity})}}];return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(E.Z,{options:!1,search:!1,bordered:!0,headerTitle:"\u5E93\u5B58\u6279\u6B21\u660E\u7EC6",columns:A,dataSource:c||[],pagination:!1})})},W=n(4393),C=n(11346),p=n(25278),F=function(c){var A=c.query,y=c.onSearch,R=(0,f.useState)({}),m=u()(R,2),h=m[0],i=m[1],g=function(s){s.Page=1,y&&y(s)};return(0,f.useEffect)(function(){i(r()({},A))},[]),(0,e.jsx)(W.Z,{bordered:!1,style:{marginBottom:10},children:(0,e.jsxs)(C.Z,{layout:"inline",children:[(0,e.jsx)(C.Z.Item,{label:"\u6279\u6B21\u53F7",children:(0,e.jsx)(p.Z,{value:h.SerialNo||"",onChange:function(s){i(function(P){return r()(r()({},P),{},{SerialNo:s.target.value})})}})}),(0,e.jsx)(C.Z.Item,{wrapperCol:{offset:8,span:16},children:(0,e.jsx)(x.ZP,{type:"primary",htmlType:"submit",onClick:function(){g(h)},children:"\u641C\u7D22"})})]})})},B=F,D=n(85576),L=n(34041),$=n(19632),S=n.n($),k=n(24435),X=n(80799),Y=n(77953),ee=n(48746),ne=function(d){var c=d.items,A=d.onChange,y=function(h,i){var g=S()(c);g[h]=i(g[h]),A(g)},R=[{title:"\u5546\u54C1",width:300,render:function(h,i,g){return(0,e.jsxs)(e.Fragment,{children:[(0,l.Wq)(i.SkuId)&&(0,e.jsx)("div",{style:{fontWeight:"bold",color:"red",marginBottom:5},children:"\u8BF7\u9009\u62E9"}),(0,e.jsx)(ee.Z,{selectedSku:i.Sku||{},onChange:function(s){if(s){if(c.some(function(P,G){return G!=G&&P.SkuId==s.Id})){_.ZP.error("\u5546\u54C1\u5DF2\u7ECF\u5B58\u5728\u4E8E\u91C7\u8D2D\u5355\uFF0C\u8BF7\u91CD\u65B0\u9009\u62E9");return}y(g,function(P){return r()(r()({},P),{},{Sku:s,SkuId:s.Id})})}},style:{width:"100%"}})]})}},{title:"\u6570\u91CF",render:function(h,i,g){return(0,e.jsxs)(e.Fragment,{children:[i.Quantity&&i.Quantity>0||(0,e.jsx)("div",{style:{fontWeight:"bold",color:"red",marginBottom:5},children:"\u8BF7\u8F93\u5165"}),(0,e.jsx)(k.Z,{min:1,value:i.Quantity,onChange:function(s){y(g,function(P){return r()(r()({},P),{},{Quantity:s||0})})}})]})}},{title:"\u8FDB\u8D27\u4EF7",render:function(h,i,g){return(0,e.jsxs)(e.Fragment,{children:[i.Price&&i.Price>0||(0,e.jsx)("div",{style:{fontWeight:"bold",color:"red",marginBottom:5},children:"\u8BF7\u8F93\u5165"}),(0,e.jsx)(k.Z,{min:0,value:i.Price,onChange:function(s){y(g,function(P){return r()(r()({},P),{},{Price:s||0})})}})]})}},{title:"\u64CD\u4F5C",render:function(h,i,g){return(0,e.jsx)(x.ZP,{type:"link",danger:!0,onClick:function(){if(confirm("\u786E\u8BA4\u5220\u9664\uFF1F")){var s=S()(c);(0,Y.Z)(s,g),A(s)}},children:"\u5220\u9664"})}}];return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(X.Z,{dataSource:c,columns:R,pagination:!1,style:{marginBottom:10}}),(0,e.jsx)(x.ZP,{block:!0,type:"dashed",onClick:function(){A([].concat(S()(c),[{Quantity:10}]))},children:"\u6DFB\u52A0\u5546\u54C1"})]})},te=function(d){var c=d.show,A=d.hide,y=d.data,R=d.ok,m=(0,f.useState)(!1),h=u()(m,2),i=h[0],g=h[1],b=(0,f.useState)([]),s=u()(b,2),P=s[0],G=s[1],w=(0,f.useState)([]),z=u()(w,2),H=z[0],re=z[1],q=(0,f.useState)({}),J=u()(q,2),M=J[0],O=J[1],ae=function(t){return!!(t.SkuId&&t.Quantity&&t.Quantity>0&&t.Price&&t.Price>0)},ue=function(t){if(!t.Items||t.Items.length<=0){_.ZP.error("\u8BF7\u6DFB\u52A0\u5546\u54C1");return}if(t.Items.some(function(a){return!ae(a)})){_.ZP.error("\u8BF7\u8F93\u5165\u91C7\u8D2D\u4FE1\u606F");return}g(!0),j.x1.mallAdmin.stockInsertStock(r()({},t)).then(function(a){(0,l._y)(a,function(){_.ZP.success("\u4FDD\u5B58\u6210\u529F"),R()})}).finally(function(){g(!1)})},oe=function(){j.x1.mallAdmin.supplierQueryAll({}).then(function(t){(0,l._y)(t,function(){re(t.data.Data||[])})}),j.x1.mallAdmin.warehouseQueryAll({}).then(function(t){(0,l._y)(t,function(){G(t.data.Data||[])})})};return(0,f.useEffect)(function(){c&&oe()},[c]),(0,f.useEffect)(function(){O(r()({},y))},[y]),(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(D.Z,{confirmLoading:i,open:c,onCancel:function(){return A()},onOk:function(){return ue(M)},width:"90%",title:"\u6DFB\u52A0\u91C7\u8D2D\u5355",forceRender:!0,destroyOnClose:!0,children:[(0,e.jsxs)(C.Z,{labelCol:{flex:"110px"},labelAlign:"right",wrapperCol:{flex:1},children:[(0,e.jsx)(C.Z.Item,{label:"\u4F9B\u5E94\u5546",name:"SupplierId",children:(0,e.jsx)(L.Z,{allowClear:!0,placeholder:"\u8BF7\u9009\u62E9\u4F9B\u8D27\u5546",value:M.SupplierId,onChange:function(t){O(function(a){return r()(r()({},a),{},{SupplierId:t})})},onClear:function(){O(r()(r()({},M),{},{SupplierId:void 0}))},options:H.map(function(o){return{label:o.Name,value:o.Id}})})}),(0,e.jsx)(C.Z.Item,{label:"\u76EE\u6807\u4ED3\u5E93",children:(0,e.jsx)(L.Z,{allowClear:!0,placeholder:"\u8BF7\u9009\u62E9\u76EE\u6807\u4ED3\u5E93",value:M.WarehouseId,onChange:function(t){O(function(a){return r()(r()({},a),{},{WarehouseId:t})})},onClear:function(){O(r()(r()({},M),{},{WarehouseId:void 0}))},options:P.map(function(o){return{label:o.Name,value:o.Id}})})}),(0,e.jsx)(C.Z.Item,{label:"\u5907\u6CE8",name:"Remark",rules:[{max:500}],children:(0,e.jsx)(p.Z.TextArea,{placeholder:"\u8BF7\u8F93\u5165\u91C7\u8D2D\u5907\u6CE8"})})]}),c&&(0,e.jsx)(ne,{items:M.Items||[],onChange:function(t){O(r()(r()({},M),{},{Items:t}))}})]})})},N=function(){var d=(0,f.useState)(!0),c=u()(d,2),A=c[0],y=c[1],R=(0,f.useState)({Items:[],TotalCount:0}),m=u()(R,2),h=m[0],i=m[1],g=(0,f.useState)({Page:1}),b=u()(g,2),s=b[0],P=b[1],G=(0,f.useState)(void 0),w=u()(G,2),z=w[0],H=w[1],re=(0,f.useState)(void 0),q=u()(re,2),J=q[0],M=q[1],O=function(t){y(!0),j.x1.mallAdmin.stockStockPaging(t).then(function(a){a.data.Error?_.ZP.error(a.data.Error.Message):i(a.data||{})}).finally(function(){y(!1)})},ae=function(t){t.Approved||confirm("\u786E\u5B9A\u6279\u51C6\u91C7\u8D2D\u5355\uFF1F")&&(M(t.Id||""),j.x1.mallAdmin.stockApproveStock({Id:t.Id}).then(function(a){(0,l._y)(a,function(){_.ZP.success("\u5DF2\u7ECF\u6279\u51C6\u91C7\u8D2D"),O(s)})}).finally(function(){M("")}))},ue=function(t){confirm("\u5220\u9664\u5165\u5E93\u5355\uFF1F")&&(M(t.Id||""),j.x1.mallAdmin.stockDeleteUnApprovedStock({Id:t.Id}).then(function(a){a.data.Error?_.ZP.error(a.data.Error.Message):(_.ZP.success("\u5220\u9664\u6210\u529F"),O(s))}).finally(function(){M("")}))},oe=[{title:"\u6279\u53F7",render:function(t,a){return(0,e.jsx)("b",{children:"".concat(a.No||"--")})}},{title:"\u5907\u6CE8\u4FE1\u606F",render:function(t,a){return a.Remark||"--"}},{title:"\u4ED3\u5E93",render:function(t,a){var K;return(0,e.jsx)("span",{children:((K=a.Warehouse)===null||K===void 0?void 0:K.Name)||"--"})}},{title:"\u4F9B\u8D27\u5546",render:function(t,a){var K;return(0,e.jsx)("span",{children:((K=a.Supplier)===null||K===void 0?void 0:K.Name)||"--"})}},{title:"\u72B6\u6001",render:function(t,a){return a.Approved?(0,e.jsx)(I.Z,{color:"green",children:"\u5DF2\u6279\u51C6"}):(0,e.jsx)(I.Z,{color:"yellow",children:"\u5F85\u5BA1\u6838"})}},{title:"\u65F6\u95F4",render:function(t,a){return(0,e.jsx)(U.Z,{model:a})}},{title:"\u64CD\u4F5C",width:200,render:function(t,a){return(0,e.jsxs)(x.ZP.Group,{children:[a.Approved||(0,e.jsx)(x.ZP,{loading:J==a.Id,type:"primary",onClick:function(){ae(a)},children:"\u5BA1\u6838"}),a.Approved||(0,e.jsx)(x.ZP,{loading:J==a.Id,danger:!0,onClick:function(){ue(a)},children:"\u5220\u9664"})]})}}];return(0,f.useEffect)(function(){O(s)},[]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(te,{show:z!=null,hide:function(){return H(void 0)},data:z||{},ok:function(){H(void 0),O(s)}}),(0,e.jsx)(B,{query:s,onSearch:function(t){P(t),O(t)}}),(0,e.jsx)(E.Z,{options:!1,search:!1,headerTitle:"\u91C7\u8D2D\u5355",toolBarRender:function(){return[(0,e.jsx)(x.ZP,{type:"primary",onClick:function(){H({})},children:"\u65B0\u589E"})]},rowKey:function(t){return t.Id||""},loading:A,columns:oe,dataSource:h.Items||[],expandable:{expandedRowRender:function(t){return(0,e.jsx)("div",{style:{padding:10,border:"5px dashed orange"},children:(0,e.jsx)(Q,{data:t.Items||[]})})}},pagination:{showSizeChanger:!1,pageSize:20,current:s.Page,total:h.TotalCount,onChange:function(t){var a=r()(r()({},s),{},{Page:t});P(a),O(a)}}})]})}}}]);
