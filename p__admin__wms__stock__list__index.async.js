"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[326],{96256:function(G,M,e){var S=e(42122),t=e.n(S),R=e(861),o=e.n(R),E=e(27424),y=e.n(E),I=e(85980),v=e(34041),W=e(57381),g=e(67294),c=e(85893);M.Z=function(p){var n=p.onSearch,K=p.value,i=p.onChange,d=p.style,u=p.initItem,x=p.placeholder,f=p.props,D=(0,g.useState)(!1),Q=y()(D,2),z=Q[0],A=Q[1],k=(0,g.useState)([]),X=y()(k,2),Y=X[0],ee=X[1],ne=(0,I.Z)(function(N){A(!0),n(N).then(function(m){ee(m||[])}).finally(function(){return A(!1)})},{wait:500});(0,g.useEffect)(function(){},[]);var te=function(){var m=o()(Y);return u&&!m.find(function(h){return h.value===u.value})&&m.push(u),m};return(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(v.Z,t()({style:t()({minWidth:300},d),loading:z,value:K,showSearch:!0,allowClear:!0,filterOption:!1,onSearch:function(m){ne.run(m)},onChange:function(m){var h=Y.find(function(B){return B.value==m});i&&i(h)},onClear:function(){i&&i(void 0)},placeholder:x||"\u8F93\u5165\u5173\u952E\u8BCD",notFoundContent:z&&(0,c.jsx)(W.Z,{size:"small"}),options:te()},f))})}},23806:function(G,M,e){var S=e(1288),t=e(85893);M.Z=function(R){var o=R.model,E=R.fallback;if(o==null||o==null)return null;var y=o==null?void 0:o.CreationTime,I=o==null?void 0:o.LastModificationTime;return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{style:{},children:[(0,t.jsx)("div",{children:(0,t.jsx)(S.Z,{prefix:(0,t.jsx)("span",{children:"\u521B\u5EFA\uFF1A"}),onlyDate:!0,timeStr:y,fallback:E})}),(0,t.jsx)("div",{children:(0,t.jsx)(S.Z,{prefix:(0,t.jsx)("span",{children:"\u4FEE\u6539\uFF1A"}),onlyDate:!0,timeStr:I,fallback:E})})]})})}},48746:function(G,M,e){var S=e(17061),t=e.n(S),R=e(17156),o=e.n(R),E=e(96256),y=e(35291),I=e(30967),v=e(42838),W=e(85893);M.Z=function(g){var c=g.selectedSku,p=g.onChange,n=g.style,K=g.props,i=function(){var d=o()(t()().mark(function u(x){var f,D,Q;return t()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(!(0,v.Wq)(x)){A.next=2;break}return A.abrupt("return",[]);case 2:return A.next=4,I.x1.mallAdmin.skuQuerySkuForSelection({Keywords:x,Take:20});case 4:return D=A.sent,Q=D==null||(f=D.data)===null||f===void 0||(f=f.Data)===null||f===void 0?void 0:f.map(function(k){return{label:(0,y.CQ)(k)||"--",value:k.Id||"--"}}),A.abrupt("return",Q||[]);case 7:case"end":return A.stop()}},u)}));return function(x){return d.apply(this,arguments)}}();return(0,W.jsx)(W.Fragment,{children:(0,W.jsx)(E.Z,{style:n,props:K,onSearch:function(){var d=o()(t()().mark(function u(x){return t()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return D.next=2,i(x);case 2:return D.abrupt("return",D.sent);case 3:case"end":return D.stop()}},u)}));return function(u){return d.apply(this,arguments)}}(),placeholder:"\u641C\u7D22\u5546\u54C1...",value:(c==null?void 0:c.Id)||void 0,initItem:c==null?void 0:{label:(0,y.CQ)(c)||"",value:c.Id||""},onChange:function(u){p&&p(u==null?void 0:{Id:u.value,Name:u.label})}})})}},47246:function(G,M,e){e.r(M),e.d(M,{default:function(){return N}});var S=e(42122),t=e.n(S),R=e(27424),o=e.n(R),E=e(45360),y=e(66309),I=e(14726),v=e(67294),W=e(23806),g=e(30967),c=e(42838),p=e(26089),n=e(85893),K=function(m){var h=m.data,B=[{title:"\u5546\u54C1",render:function(L,C){var j,_;return(0,n.jsx)("span",{children:"".concat(((j=C.Goods)===null||j===void 0?void 0:j.Name)||"--","/").concat(((_=C.Sku)===null||_===void 0?void 0:_.Name)||"--")})}},{title:"\u91C7\u8D2D\u5355\u4EF7",render:function(L,C){return(0,n.jsx)("span",{children:C.Price})}},{title:"\u91C7\u8D2D\u6570\u91CF",render:function(L,C){return(0,n.jsx)("span",{children:C.Quantity})}}];return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(p.Z,{options:!1,search:!1,bordered:!0,headerTitle:"\u5E93\u5B58\u6279\u6B21\u660E\u7EC6",columns:B,dataSource:h||[],pagination:!1})})},i=e(4393),d=e(11346),u=e(25278),x=function(h){var B=h.query,O=h.onSearch,L=(0,v.useState)({}),C=o()(L,2),j=C[0],_=C[1],P=function(s){s.Page=1,O&&O(s)};return(0,v.useEffect)(function(){_(t()({},B))},[]),(0,n.jsx)(i.Z,{bordered:!1,style:{marginBottom:10},children:(0,n.jsxs)(d.Z,{layout:"inline",children:[(0,n.jsx)(d.Z.Item,{label:"\u6279\u6B21\u53F7",children:(0,n.jsx)(u.Z,{value:j.SerialNo||"",onChange:function(s){_(function(Z){return t()(t()({},Z),{},{SerialNo:s.target.value})})}})}),(0,n.jsx)(d.Z.Item,{wrapperCol:{offset:8,span:16},children:(0,n.jsx)(I.ZP,{type:"primary",htmlType:"submit",onClick:function(){P(j)},children:"\u641C\u7D22"})})]})})},f=x,D=e(85576),Q=e(34041),z=e(861),A=e.n(z),k=e(24435),X=e(80799),Y=e(77953),ee=e(48746),ne=function(m){var h=m.items,B=m.onChange,O=function(j,_){var P=A()(h);P[j]=_(P[j]),B(P)},L=[{title:"\u5546\u54C1",width:300,render:function(j,_,P){return(0,n.jsxs)(n.Fragment,{children:[(0,c.Wq)(_.SkuId)&&(0,n.jsx)("div",{style:{fontWeight:"bold",color:"red",marginBottom:5},children:"\u8BF7\u9009\u62E9"}),(0,n.jsx)(ee.Z,{selectedSku:_.Sku||{},onChange:function(s){if(s){if(h.some(function(Z,$){return $!=$&&Z.SkuId==s.Id})){E.ZP.error("\u5546\u54C1\u5DF2\u7ECF\u5B58\u5728\u4E8E\u91C7\u8D2D\u5355\uFF0C\u8BF7\u91CD\u65B0\u9009\u62E9");return}O(P,function(Z){return t()(t()({},Z),{},{Sku:s,SkuId:s.Id})})}},style:{width:"100%"}})]})}},{title:"\u6570\u91CF",render:function(j,_,P){return(0,n.jsxs)(n.Fragment,{children:[_.Quantity&&_.Quantity>0||(0,n.jsx)("div",{style:{fontWeight:"bold",color:"red",marginBottom:5},children:"\u8BF7\u8F93\u5165"}),(0,n.jsx)(k.Z,{min:1,value:_.Quantity,onChange:function(s){O(P,function(Z){return t()(t()({},Z),{},{Quantity:s||0})})}})]})}},{title:"\u8FDB\u8D27\u4EF7",render:function(j,_,P){return(0,n.jsxs)(n.Fragment,{children:[_.Price&&_.Price>0||(0,n.jsx)("div",{style:{fontWeight:"bold",color:"red",marginBottom:5},children:"\u8BF7\u8F93\u5165"}),(0,n.jsx)(k.Z,{min:0,value:_.Price,onChange:function(s){O(P,function(Z){return t()(t()({},Z),{},{Price:s||0})})}})]})}},{title:"\u64CD\u4F5C",render:function(j,_,P){return(0,n.jsx)(I.ZP,{type:"link",danger:!0,onClick:function(){if(confirm("\u786E\u8BA4\u5220\u9664\uFF1F")){var s=A()(h);(0,Y.Z)(s,P),B(s)}},children:"\u5220\u9664"})}}];return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(X.Z,{dataSource:h,columns:L,pagination:!1,style:{marginBottom:10}}),(0,n.jsx)(I.ZP,{block:!0,type:"dashed",onClick:function(){B([].concat(A()(h),[{Quantity:10}]))},children:"\u6DFB\u52A0\u5546\u54C1"})]})},te=function(m){var h=m.show,B=m.hide,O=m.data,L=m.ok,C=(0,v.useState)(!1),j=o()(C,2),_=j[0],P=j[1],F=(0,v.useState)([]),s=o()(F,2),Z=s[0],$=s[1],w=(0,v.useState)([]),H=o()(w,2),J=H[0],ae=H[1],q=(0,v.useState)({}),V=o()(q,2),U=V[0],T=V[1],re=function(a){return!!(a.SkuId&&a.Quantity&&a.Quantity>0&&a.Price&&a.Price>0)},ue=function(a){if(!a.Items||a.Items.length<=0){E.ZP.error("\u8BF7\u6DFB\u52A0\u5546\u54C1");return}if(a.Items.some(function(r){return!re(r)})){E.ZP.error("\u8BF7\u8F93\u5165\u91C7\u8D2D\u4FE1\u606F");return}P(!0),g.x1.mallAdmin.stockInsertStock(t()({},a)).then(function(r){(0,c._y)(r,function(){E.ZP.success("\u4FDD\u5B58\u6210\u529F"),L()})}).finally(function(){P(!1)})},le=function(){g.x1.mallAdmin.supplierQueryAll({}).then(function(a){(0,c._y)(a,function(){ae(a.data.Data||[])})}),g.x1.mallAdmin.warehouseQueryAll({}).then(function(a){(0,c._y)(a,function(){$(a.data.Data||[])})})};return(0,v.useEffect)(function(){h&&le()},[h]),(0,v.useEffect)(function(){T(t()({},O))},[O]),(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(D.Z,{confirmLoading:_,open:h,onCancel:function(){return B()},onOk:function(){return ue(U)},width:"90%",title:"\u6DFB\u52A0\u91C7\u8D2D\u5355",forceRender:!0,destroyOnClose:!0,children:[(0,n.jsxs)(d.Z,{labelCol:{flex:"110px"},labelAlign:"right",wrapperCol:{flex:1},children:[(0,n.jsx)(d.Z.Item,{label:"\u4F9B\u5E94\u5546",name:"SupplierId",children:(0,n.jsx)(Q.Z,{allowClear:!0,placeholder:"\u8BF7\u9009\u62E9\u4F9B\u8D27\u5546",value:U.SupplierId,onChange:function(a){T(function(r){return t()(t()({},r),{},{SupplierId:a})})},onClear:function(){T(t()(t()({},U),{},{SupplierId:void 0}))},options:J.map(function(l){return{label:l.Name,value:l.Id}})})}),(0,n.jsx)(d.Z.Item,{label:"\u76EE\u6807\u4ED3\u5E93",children:(0,n.jsx)(Q.Z,{allowClear:!0,placeholder:"\u8BF7\u9009\u62E9\u76EE\u6807\u4ED3\u5E93",value:U.WarehouseId,onChange:function(a){T(function(r){return t()(t()({},r),{},{WarehouseId:a})})},onClear:function(){T(t()(t()({},U),{},{WarehouseId:void 0}))},options:Z.map(function(l){return{label:l.Name,value:l.Id}})})}),(0,n.jsx)(d.Z.Item,{label:"\u5907\u6CE8",name:"Remark",rules:[{max:500}],children:(0,n.jsx)(u.Z.TextArea,{placeholder:"\u8BF7\u8F93\u5165\u91C7\u8D2D\u5907\u6CE8"})})]}),h&&(0,n.jsx)(ne,{items:U.Items||[],onChange:function(a){T(t()(t()({},U),{},{Items:a}))}})]})})},N=function(){var m=(0,v.useState)(!0),h=o()(m,2),B=h[0],O=h[1],L=(0,v.useState)({Items:[],TotalCount:0}),C=o()(L,2),j=C[0],_=C[1],P=(0,v.useState)({Page:1}),F=o()(P,2),s=F[0],Z=F[1],$=(0,v.useState)(void 0),w=o()($,2),H=w[0],J=w[1],ae=(0,v.useState)(void 0),q=o()(ae,2),V=q[0],U=q[1],T=function(a){O(!0),g.x1.mallAdmin.stockStockPaging(a).then(function(r){r.data.Error?E.ZP.error(r.data.Error.Message):_(r.data||{})}).finally(function(){O(!1)})},re=function(a){a.Approved||confirm("\u786E\u5B9A\u6279\u51C6\u91C7\u8D2D\u5355\uFF1F")&&(U(a.Id||""),g.x1.mallAdmin.stockApproveStock({Id:a.Id}).then(function(r){(0,c._y)(r,function(){E.ZP.success("\u5DF2\u7ECF\u6279\u51C6\u91C7\u8D2D"),T(s)})}).finally(function(){U("")}))},ue=function(a){confirm("\u5220\u9664\u5165\u5E93\u5355\uFF1F")&&(U(a.Id||""),g.x1.mallAdmin.stockDeleteUnApprovedStock({Id:a.Id}).then(function(r){r.data.Error?E.ZP.error(r.data.Error.Message):(E.ZP.success("\u5220\u9664\u6210\u529F"),T(s))}).finally(function(){U("")}))},le=[{title:"\u6279\u53F7",render:function(a,r){return(0,n.jsx)("b",{children:"".concat(r.No||"--")})}},{title:"\u5907\u6CE8\u4FE1\u606F",render:function(a,r){return r.Remark||"--"}},{title:"\u4ED3\u5E93",render:function(a,r){var b;return(0,n.jsx)("span",{children:((b=r.Warehouse)===null||b===void 0?void 0:b.Name)||"--"})}},{title:"\u4F9B\u8D27\u5546",render:function(a,r){var b;return(0,n.jsx)("span",{children:((b=r.Supplier)===null||b===void 0?void 0:b.Name)||"--"})}},{title:"\u72B6\u6001",render:function(a,r){return r.Approved?(0,n.jsx)(y.Z,{color:"green",children:"\u5DF2\u6279\u51C6"}):(0,n.jsx)(y.Z,{color:"yellow",children:"\u5F85\u5BA1\u6838"})}},{title:"\u65F6\u95F4",render:function(a,r){return(0,n.jsx)(W.Z,{model:r})}},{title:"\u64CD\u4F5C",width:200,render:function(a,r){return(0,n.jsxs)(I.ZP.Group,{children:[r.Approved||(0,n.jsx)(I.ZP,{loading:V==r.Id,type:"primary",onClick:function(){re(r)},children:"\u5BA1\u6838"}),r.Approved||(0,n.jsx)(I.ZP,{loading:V==r.Id,danger:!0,onClick:function(){ue(r)},children:"\u5220\u9664"})]})}}];return(0,v.useEffect)(function(){T(s)},[]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(te,{show:H!=null,hide:function(){return J(void 0)},data:H||{},ok:function(){J(void 0),T(s)}}),(0,n.jsx)(f,{query:s,onSearch:function(a){Z(a),T(a)}}),(0,n.jsx)(p.Z,{options:!1,search:!1,headerTitle:"\u91C7\u8D2D\u5355",toolBarRender:function(){return[(0,n.jsx)(I.ZP,{type:"primary",onClick:function(){J({})},children:"\u65B0\u589E"})]},rowKey:function(a){return a.Id||""},loading:B,columns:le,dataSource:j.Items||[],expandable:{expandedRowRender:function(a){return(0,n.jsx)("div",{style:{padding:10,border:"5px dashed orange"},children:(0,n.jsx)(K,{data:a.Items||[]})})}},pagination:{showSizeChanger:!1,pageSize:20,current:s.Page,total:j.TotalCount,onChange:function(a){var r=t()(t()({},s),{},{Page:a});Z(r),T(r)}}})]})}},85980:function(G,M,e){var S=e(97582),t=e(23279),R=e.n(t),o=e(67294),E=e(3930),y=e(45210),I=e(92770),v=e(31663);function W(g,c){var p;v.Z&&((0,I.mf)(g)||console.error("useDebounceFn expected parameter is a function, got ".concat(typeof g)));var n=(0,E.Z)(g),K=(p=c==null?void 0:c.wait)!==null&&p!==void 0?p:1e3,i=(0,o.useMemo)(function(){return R()(function(){for(var d=[],u=0;u<arguments.length;u++)d[u]=arguments[u];return n.current.apply(n,(0,S.ev)([],(0,S.CR)(d),!1))},K,c)},[]);return(0,y.Z)(function(){i.cancel()}),{run:i,cancel:i.cancel,flush:i.flush}}M.Z=W},935:function(G,M){function e(S){var t=S==null?0:S.length;return t?S[t-1]:void 0}M.Z=e},77953:function(G,M,e){e.d(M,{Z:function(){return K}});var S=e(74073),t=e(16423);function R(i,d){for(var u=-1,x=d.length,f=Array(x),D=i==null;++u<x;)f[u]=D?void 0:(0,t.Z)(i,d[u]);return f}var o=R,E=e(49344),y=e(56009),I=Array.prototype,v=I.splice;function W(i,d){for(var u=i?d.length:0,x=u-1;u--;){var f=d[u];if(u==x||f!==D){var D=f;(0,y.Z)(f)?v.call(i,f,1):(0,E.Z)(i,f)}}return i}var g=W,c=e(97109),p=e(94008),n=(0,p.Z)(function(i,d){var u=i==null?0:i.length,x=o(i,d);return g(i,(0,S.Z)(d,function(f){return(0,y.Z)(f,u)?+f:f}).sort(c.Z)),x}),K=n}}]);
