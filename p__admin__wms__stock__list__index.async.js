"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[326],{96256:function($,T,e){var M=e(42122),a=e.n(M),R=e(861),o=e.n(R),E=e(27424),x=e.n(E),S=e(85980),v=e(34041),W=e(57381),g=e(67294),c=e(85893);T.Z=function(p){var n=p.onSearch,K=p.value,i=p.onChange,d=p.style,u=p.initItem,I=p.placeholder,f=p.props,D=(0,g.useState)(!1),Q=x()(D,2),z=Q[0],y=Q[1],k=(0,g.useState)([]),X=x()(k,2),Y=X[0],ee=X[1],ne=(0,S.Z)(function(N){y(!0),n(N).then(function(m){ee(m||[])}).finally(function(){return y(!1)})},{wait:500});(0,g.useEffect)(function(){},[]);var te=function(){var m=o()(Y);return u&&!m.find(function(h){return h.value===u.value})&&m.push(u),m};return(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(v.Z,a()({style:a()({minWidth:300},d),loading:z,value:K,showSearch:!0,allowClear:!0,filterOption:!1,onSearch:function(m){ne.run(m)},onChange:function(m){var h=Y.find(function(Z){return Z.value==m});i&&i(h)},onClear:function(){i&&i(void 0)},placeholder:I||"\u8F93\u5165\u5173\u952E\u8BCD",notFoundContent:z&&(0,c.jsx)(W.Z,{size:"small"}),options:te()},f))})}},23806:function($,T,e){var M=e(1288),a=e(85893);T.Z=function(R){var o=R.model,E=R.fallback;if(o==null||o==null)return null;var x=o==null?void 0:o.CreationTime,S=o==null?void 0:o.LastModificationTime;return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{style:{},children:[(0,a.jsx)("div",{children:(0,a.jsx)(M.Z,{prefix:(0,a.jsx)("span",{children:"\u521B\u5EFA\uFF1A"}),onlyDate:!0,timeStr:x,fallback:E})}),(0,a.jsx)("div",{children:(0,a.jsx)(M.Z,{prefix:(0,a.jsx)("span",{children:"\u4FEE\u6539\uFF1A"}),onlyDate:!0,timeStr:S,fallback:E})})]})})}},48746:function($,T,e){var M=e(17061),a=e.n(M),R=e(17156),o=e.n(R),E=e(96256),x=e(35291),S=e(30967),v=e(42838),W=e(85893);T.Z=function(g){var c=g.selectedSku,p=g.onChange,n=g.style,K=g.props,i=function(){var d=o()(a()().mark(function u(I){var f,D,Q;return a()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(!(0,v.Wq)(I)){y.next=2;break}return y.abrupt("return",[]);case 2:return y.next=4,S.x1.mallAdmin.skuQuerySkuForSelection({Keywords:I,Take:20});case 4:return D=y.sent,Q=D==null||(f=D.data)===null||f===void 0||(f=f.Data)===null||f===void 0?void 0:f.map(function(k){return{label:(0,x.CQ)(k)||"--",value:k.Id||"--"}}),y.abrupt("return",Q||[]);case 7:case"end":return y.stop()}},u)}));return function(I){return d.apply(this,arguments)}}();return(0,W.jsx)(W.Fragment,{children:(0,W.jsx)(E.Z,{style:n,props:K,onSearch:function(){var d=o()(a()().mark(function u(I){return a()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return D.next=2,i(I);case 2:return D.abrupt("return",D.sent);case 3:case"end":return D.stop()}},u)}));return function(u){return d.apply(this,arguments)}}(),placeholder:"\u641C\u7D22\u5546\u54C1...",value:(c==null?void 0:c.Id)||void 0,initItem:c==null?void 0:{label:(0,x.CQ)(c)||"",value:c.Id||""},onChange:function(u){p&&p(u==null?void 0:{Id:u.value,Name:u.label})}})})}},47246:function($,T,e){e.r(T),e.d(T,{default:function(){return N}});var M=e(42122),a=e.n(M),R=e(27424),o=e.n(R),E=e(45360),x=e(66309),S=e(14726),v=e(67294),W=e(23806),g=e(30967),c=e(42838),p=e(26089),n=e(85893),K=function(m){var h=m.data,Z=[{title:"\u5546\u54C1",render:function(L,C){var j,_;return(0,n.jsx)("span",{children:"".concat(((j=C.Goods)===null||j===void 0?void 0:j.Name)||"--","/").concat(((_=C.Sku)===null||_===void 0?void 0:_.Name)||"--")})}},{title:"\u91C7\u8D2D\u5355\u4EF7",render:function(L,C){return(0,n.jsx)("span",{children:C.Price})}},{title:"\u91C7\u8D2D\u6570\u91CF",render:function(L,C){return(0,n.jsx)("span",{children:C.Quantity})}}];return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(p.Z,{options:!1,search:!1,bordered:!0,headerTitle:"\u5E93\u5B58\u6279\u6B21\u660E\u7EC6",columns:Z,dataSource:h||[],pagination:!1})})},i=e(4393),d=e(11346),u=e(25278),I=function(h){var Z=h.query,A=h.onSearch,L=(0,v.useState)({}),C=o()(L,2),j=C[0],_=C[1],P=function(s){s.Page=1,A&&A(s)};return(0,v.useEffect)(function(){_(a()({},Z))},[]),(0,n.jsx)(i.Z,{bordered:!1,style:{marginBottom:10},children:(0,n.jsxs)(d.Z,{layout:"inline",children:[(0,n.jsx)(d.Z.Item,{label:"\u6279\u6B21\u53F7",children:(0,n.jsx)(u.Z,{value:j.SerialNo||"",onChange:function(s){_(function(O){return a()(a()({},O),{},{SerialNo:s.target.value})})}})}),(0,n.jsx)(d.Z.Item,{wrapperCol:{offset:8,span:16},children:(0,n.jsx)(S.ZP,{type:"primary",htmlType:"submit",onClick:function(){P(j)},children:"\u641C\u7D22"})})]})})},f=I,D=e(85576),Q=e(34041),z=e(861),y=e.n(z),k=e(24435),X=e(80799),Y=e(77953),ee=e(48746),ne=function(m){var h=m.items,Z=m.onChange,A=function(j,_){var P=y()(h);P[j]=_(P[j]),Z(P)},L=[{title:"\u5546\u54C1",width:300,render:function(j,_,P){return(0,n.jsxs)(n.Fragment,{children:[(0,c.Wq)(_.SkuId)&&(0,n.jsx)("div",{style:{fontWeight:"bold",color:"red",marginBottom:5},children:"\u8BF7\u9009\u62E9"}),(0,n.jsx)(ee.Z,{selectedSku:_.Sku||{},onChange:function(s){if(s){if(h.some(function(O,G){return G!=G&&O.SkuId==s.Id})){E.ZP.error("\u5546\u54C1\u5DF2\u7ECF\u5B58\u5728\u4E8E\u91C7\u8D2D\u5355\uFF0C\u8BF7\u91CD\u65B0\u9009\u62E9");return}A(P,function(O){return a()(a()({},O),{},{Sku:s,SkuId:s.Id})})}},style:{width:"100%"}})]})}},{title:"\u6570\u91CF",render:function(j,_,P){return(0,n.jsxs)(n.Fragment,{children:[_.Quantity&&_.Quantity>0||(0,n.jsx)("div",{style:{fontWeight:"bold",color:"red",marginBottom:5},children:"\u8BF7\u8F93\u5165"}),(0,n.jsx)(k.Z,{min:1,value:_.Quantity,onChange:function(s){A(P,function(O){return a()(a()({},O),{},{Quantity:s||0})})}})]})}},{title:"\u8FDB\u8D27\u4EF7",render:function(j,_,P){return(0,n.jsxs)(n.Fragment,{children:[_.Price&&_.Price>0||(0,n.jsx)("div",{style:{fontWeight:"bold",color:"red",marginBottom:5},children:"\u8BF7\u8F93\u5165"}),(0,n.jsx)(k.Z,{min:0,value:_.Price,onChange:function(s){A(P,function(O){return a()(a()({},O),{},{Price:s||0})})}})]})}},{title:"\u64CD\u4F5C",render:function(j,_,P){return(0,n.jsx)(S.ZP,{type:"link",danger:!0,onClick:function(){if(confirm("\u786E\u8BA4\u5220\u9664\uFF1F")){var s=y()(h);(0,Y.Z)(s,P),Z(s)}},children:"\u5220\u9664"})}}];return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(X.Z,{dataSource:h,columns:L,pagination:!1,style:{marginBottom:10}}),(0,n.jsx)(S.ZP,{block:!0,type:"dashed",onClick:function(){Z([].concat(y()(h),[{Quantity:10}]))},children:"\u6DFB\u52A0\u5546\u54C1"})]})},te=function(m){var h=m.show,Z=m.hide,A=m.data,L=m.ok,C=(0,v.useState)(!1),j=o()(C,2),_=j[0],P=j[1],F=(0,v.useState)([]),s=o()(F,2),O=s[0],G=s[1],w=(0,v.useState)([]),H=o()(w,2),J=H[0],ae=H[1],q=(0,v.useState)({}),V=o()(q,2),U=V[0],B=V[1],re=function(t){return!!(t.SkuId&&t.Quantity&&t.Quantity>0&&t.Price&&t.Price>0)},ue=function(t){if(!t.Items||t.Items.length<=0){E.ZP.error("\u8BF7\u6DFB\u52A0\u5546\u54C1");return}if(t.Items.some(function(r){return!re(r)})){E.ZP.error("\u8BF7\u8F93\u5165\u91C7\u8D2D\u4FE1\u606F");return}P(!0),g.x1.mallAdmin.stockInsertStock(a()({},t)).then(function(r){(0,c._y)(r,function(){E.ZP.success("\u4FDD\u5B58\u6210\u529F"),L()})}).finally(function(){P(!1)})},le=function(){g.x1.mallAdmin.supplierQueryAll({}).then(function(t){(0,c._y)(t,function(){ae(t.data.Data||[])})}),g.x1.mallAdmin.warehouseQueryAll({}).then(function(t){(0,c._y)(t,function(){G(t.data.Data||[])})})};return(0,v.useEffect)(function(){h&&le()},[h]),(0,v.useEffect)(function(){B(a()({},A))},[A]),(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(D.Z,{confirmLoading:_,open:h,onCancel:function(){return Z()},onOk:function(){return ue(U)},width:"90%",title:"\u6DFB\u52A0\u91C7\u8D2D\u5355",forceRender:!0,destroyOnClose:!0,children:[(0,n.jsxs)(d.Z,{labelCol:{flex:"110px"},labelAlign:"right",wrapperCol:{flex:1},children:[(0,n.jsx)(d.Z.Item,{label:"\u4F9B\u5E94\u5546",name:"SupplierId",children:(0,n.jsx)(Q.Z,{allowClear:!0,placeholder:"\u8BF7\u9009\u62E9\u4F9B\u8D27\u5546",value:U.SupplierId,onChange:function(t){B(function(r){return a()(a()({},r),{},{SupplierId:t})})},onClear:function(){B(a()(a()({},U),{},{SupplierId:void 0}))},options:J.map(function(l){return{label:l.Name,value:l.Id}})})}),(0,n.jsx)(d.Z.Item,{label:"\u76EE\u6807\u4ED3\u5E93",children:(0,n.jsx)(Q.Z,{allowClear:!0,placeholder:"\u8BF7\u9009\u62E9\u76EE\u6807\u4ED3\u5E93",value:U.WarehouseId,onChange:function(t){B(function(r){return a()(a()({},r),{},{WarehouseId:t})})},onClear:function(){B(a()(a()({},U),{},{WarehouseId:void 0}))},options:O.map(function(l){return{label:l.Name,value:l.Id}})})}),(0,n.jsx)(d.Z.Item,{label:"\u5907\u6CE8",name:"Remark",rules:[{max:500}],children:(0,n.jsx)(u.Z.TextArea,{placeholder:"\u8BF7\u8F93\u5165\u91C7\u8D2D\u5907\u6CE8"})})]}),h&&(0,n.jsx)(ne,{items:U.Items||[],onChange:function(t){B(a()(a()({},U),{},{Items:t}))}})]})})},N=function(){var m=(0,v.useState)(!0),h=o()(m,2),Z=h[0],A=h[1],L=(0,v.useState)({Items:[],TotalCount:0}),C=o()(L,2),j=C[0],_=C[1],P=(0,v.useState)({Page:1}),F=o()(P,2),s=F[0],O=F[1],G=(0,v.useState)(void 0),w=o()(G,2),H=w[0],J=w[1],ae=(0,v.useState)(void 0),q=o()(ae,2),V=q[0],U=q[1],B=function(t){A(!0),g.x1.mallAdmin.stockStockPaging(t).then(function(r){r.data.Error?E.ZP.error(r.data.Error.Message):_(r.data||{})}).finally(function(){A(!1)})},re=function(t){t.Approved||confirm("\u786E\u5B9A\u6279\u51C6\u91C7\u8D2D\u5355\uFF1F")&&(U(t.Id||""),g.x1.mallAdmin.stockApproveStock({Id:t.Id}).then(function(r){(0,c._y)(r,function(){E.ZP.success("\u5DF2\u7ECF\u6279\u51C6\u91C7\u8D2D"),B(s)})}).finally(function(){U("")}))},ue=function(t){confirm("\u5220\u9664\u5165\u5E93\u5355\uFF1F")&&(U(t.Id||""),g.x1.mallAdmin.stockDeleteUnApprovedStock({Id:t.Id}).then(function(r){r.data.Error?E.ZP.error(r.data.Error.Message):(E.ZP.success("\u5220\u9664\u6210\u529F"),B(s))}).finally(function(){U("")}))},le=[{title:"\u6279\u53F7",render:function(t,r){return(0,n.jsx)("b",{children:"".concat(r.No||"--")})}},{title:"\u5907\u6CE8\u4FE1\u606F",render:function(t,r){return r.Remark||"--"}},{title:"\u4ED3\u5E93",render:function(t,r){var b;return(0,n.jsx)("span",{children:((b=r.Warehouse)===null||b===void 0?void 0:b.Name)||"--"})}},{title:"\u4F9B\u8D27\u5546",render:function(t,r){var b;return(0,n.jsx)("span",{children:((b=r.Supplier)===null||b===void 0?void 0:b.Name)||"--"})}},{title:"\u72B6\u6001",render:function(t,r){return r.Approved?(0,n.jsx)(x.Z,{color:"green",children:"\u5DF2\u6279\u51C6"}):(0,n.jsx)(x.Z,{color:"yellow",children:"\u5F85\u5BA1\u6838"})}},{title:"\u65F6\u95F4",render:function(t,r){return(0,n.jsx)(W.Z,{model:r})}},{title:"\u64CD\u4F5C",width:200,render:function(t,r){return(0,n.jsxs)(S.ZP.Group,{children:[r.Approved||(0,n.jsx)(S.ZP,{loading:V==r.Id,type:"primary",onClick:function(){re(r)},children:"\u5BA1\u6838"}),r.Approved||(0,n.jsx)(S.ZP,{loading:V==r.Id,danger:!0,onClick:function(){ue(r)},children:"\u5220\u9664"})]})}}];return(0,v.useEffect)(function(){B(s)},[]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(te,{show:H!=null,hide:function(){return J(void 0)},data:H||{},ok:function(){J(void 0),B(s)}}),(0,n.jsx)(f,{query:s,onSearch:function(t){O(t),B(t)}}),(0,n.jsx)(p.Z,{options:!1,search:!1,headerTitle:"\u91C7\u8D2D\u5355",toolBarRender:function(){return[(0,n.jsx)(S.ZP,{type:"primary",onClick:function(){J({})},children:"\u65B0\u589E"})]},rowKey:function(t){return t.Id||""},loading:Z,columns:le,dataSource:j.Items||[],expandable:{expandedRowRender:function(t){return(0,n.jsx)("div",{style:{padding:10,border:"5px dashed orange"},children:(0,n.jsx)(K,{data:t.Items||[]})})}},pagination:{showSizeChanger:!1,pageSize:20,current:s.Page,total:j.TotalCount,onChange:function(t){var r=a()(a()({},s),{},{Page:t});O(r),B(r)}}})]})}},85980:function($,T,e){var M=e(97582),a=e(23279),R=e.n(a),o=e(67294),E=e(3930),x=e(45210),S=e(92770),v=e(31663);function W(g,c){var p;v.Z&&((0,S.mf)(g)||console.error("useDebounceFn expected parameter is a function, got ".concat(typeof g)));var n=(0,E.Z)(g),K=(p=c==null?void 0:c.wait)!==null&&p!==void 0?p:1e3,i=(0,o.useMemo)(function(){return R()(function(){for(var d=[],u=0;u<arguments.length;u++)d[u]=arguments[u];return n.current.apply(n,(0,M.ev)([],(0,M.CR)(d),!1))},K,c)},[]);return(0,x.Z)(function(){i.cancel()}),{run:i,cancel:i.cancel,flush:i.flush}}T.Z=W},77953:function($,T,e){e.d(T,{Z:function(){return K}});var M=e(74073),a=e(16423);function R(i,d){for(var u=-1,I=d.length,f=Array(I),D=i==null;++u<I;)f[u]=D?void 0:(0,a.Z)(i,d[u]);return f}var o=R,E=e(49344),x=e(56009),S=Array.prototype,v=S.splice;function W(i,d){for(var u=i?d.length:0,I=u-1;u--;){var f=d[u];if(u==I||f!==D){var D=f;(0,x.Z)(f)?v.call(i,f,1):(0,E.Z)(i,f)}}return i}var g=W,c=e(97109),p=e(94008),n=(0,p.Z)(function(i,d){var u=i==null?0:i.length,I=o(i,d);return g(i,(0,M.Z)(d,function(f){return(0,x.Z)(f,u)?+f:f}).sort(c.Z)),I}),K=n}}]);
