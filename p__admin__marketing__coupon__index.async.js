"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1156],{74590:function(H,_,n){var O=n(15009),r=n.n(O),y=n(99289),l=n.n(y),F=n(5574),T=n.n(F),B=n(83062),A=n(14726),N=n(67294),b=n(85893);_.Z=function(o){var U=o.action,W=o.confirmText,k=o.hide,P=(0,N.useState)(!1),K=T()(P,2),$=K[0],V=K[1],G=W||"\u786E\u5B9A\u5220\u9664\uFF1F",X=function(){var L=l()(r()().mark(function J(){return r()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(confirm(G)){c.next=2;break}return c.abrupt("return");case 2:return V(!0),c.prev=3,c.next=6,U();case 6:return c.prev=6,V(!1),c.finish(6);case 9:case"end":return c.stop()}},J,null,[[3,,6,9]])}));return function(){return L.apply(this,arguments)}}();return k?null:(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(B.Z,{title:G,children:(0,b.jsx)(A.ZP,{loading:$,danger:!0,type:"link",onClick:function(){X()},children:"\u5220\u9664"})})})}},23806:function(H,_,n){var O=n(1288),r=n(85893);_.Z=function(y){var l=y.model,F=y.fallback;if(l==null||l==null)return null;var T=l==null?void 0:l.CreationTime,B=l==null?void 0:l.LastModificationTime;return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{style:{},children:[(0,r.jsx)("div",{children:(0,r.jsx)(O.Z,{prefix:(0,r.jsx)("span",{children:"\u521B\u5EFA\uFF1A"}),onlyDate:!0,timeStr:T,fallback:F})}),(0,r.jsx)("div",{children:(0,r.jsx)(O.Z,{prefix:(0,r.jsx)("span",{children:"\u4FEE\u6539\uFF1A"}),onlyDate:!0,timeStr:B,fallback:F})})]})})}},1288:function(H,_,n){var O=n(78957),r=n(83062),y=n(46629),l=n(85893);_.Z=function(F){var T,B=F.timeStr,A=F.fallback,N=F.onlyDate,b=F.prefix,o=(T=(0,y.mg)(B))===null||T===void 0?void 0:T.add(y.Mg,"hour");if(!o)return A||null;var U=(0,y.ND)().utc().add(y.Mg,"hour"),W=o.isSame(U,"year"),k=o.diff(U,"day"),P=W?o.format(y.AK):o.format(y.vc),K=function(){return(0,l.jsxs)("div",{children:[(0,l.jsxs)(O.Z,{direction:"horizontal",children:[(0,l.jsx)("div",{children:o.fromNow()}),(0,l.jsx)("div",{children:o.format(y.On)})]}),(0,l.jsx)("div",{children:o.format(y.t9)})]})};return(0,l.jsx)(r.Z,{title:K(),children:(0,l.jsxs)(O.Z,{direction:"horizontal",children:[b,(0,l.jsx)("div",{className:"inline-block cursor-pointer hover:bg-orange-500",children:N?o.format(y.vc):o.format(y.dq)})]})})}},39611:function(H,_,n){n.r(_),n.d(_,{default:function(){return pe}});var O=n(97857),r=n.n(O),y=n(5574),l=n.n(y),F=n(68421),T=n(66309),B=n(40411),A=n(14726),N=n(4393),b=n(80799),o=n(67294),U=n(23806),W=n(1288),k=n(30699),P=n(95813),K=n(15009),$=n.n(K),V=n(99289),G=n.n(V),X=n(45360),L=n(85576),J=n(78957),w=n(57381),c=n(11346),q=n(71230),Q=n(15746),ee=n(65233),z=n(24435),re=n(96864),ae=n(72269),ue=n(74590),R=n(46629),oe=n(19632),Y=n.n(oe),ie=n(83062),le=n(85418),se=n(77953),de=n(70278),ne=n(34041),e=n(85893),ce=function(j){var i,g,Z,D=j.rule,d=j.ok,x=(0,o.useState)({}),E=l()(x,2),f=E[0],p=E[1],h=(0,o.useState)(!1),C=l()(h,2),m=C[0],t=C[1],u=(0,F.Z)(k.x1.mallAdmin.brandListBrand,{manual:!0}),a=((i=u.data)===null||i===void 0||(i=i.data)===null||i===void 0?void 0:i.Data)||[];return(0,o.useEffect)(function(){p(r()({},D))},[D]),(0,o.useEffect)(function(){m&&u.run({})},[m]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(A.ZP,{block:!0,onClick:function(){t(!0)},children:"\u9650\u5B9A\u54C1\u724C(".concat(((g=D.SupportedBrands)===null||g===void 0?void 0:g.map(function(S){return S.Name}).join(","))||"--",")")}),(0,e.jsx)(L.Z,{title:"\u9650\u5B9A\u54C1\u724C\u53EF\u7528",open:m,onCancel:function(){t(!1)},onOk:function(){d(r()({},f)),t(!1)},children:(0,e.jsx)(c.Z,{children:(0,e.jsx)(c.Z.Item,{label:"\u54C1\u724C",children:(0,e.jsx)(ne.Z,{mode:"multiple",maxTagCount:100,loading:u.loading,value:(Z=f.SupportedBrands)===null||Z===void 0?void 0:Z.map(function(S){return S.Id}),onChange:function(v){p(r()(r()({},f),{},{SupportedBrands:a.filter(function(s){return v.indexOf(s.Id)>=0})}))},options:a.map(function(S){return{label:S.Name,value:S.Id||""}})})})})})]})},fe=n(39019),te=n(35291),me=function(j){var i,g,Z,D=j.rule,d=j.ok,x=(0,o.useState)({}),E=l()(x,2),f=E[0],p=E[1],h=(0,o.useState)(!1),C=l()(h,2),m=C[0],t=C[1],u=(0,F.Z)(k.x1.mallAdmin.categoryQueryAntdTree,{manual:!0}),a=((i=u.data)===null||i===void 0||(i=i.data)===null||i===void 0?void 0:i.Data)||[],S=a.flatMap(function(v){return(0,te.PC)(v)});return(0,o.useEffect)(function(){p(r()({},D))},[D]),(0,o.useEffect)(function(){m&&u.run({})},[m]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(A.ZP,{block:!0,onClick:function(){t(!0)},children:"\u9650\u5B9A\u5206\u7C7B(".concat(((g=D.SupportedCategories)===null||g===void 0?void 0:g.map(function(v){return v.Name}).join(","))||"--",")")}),(0,e.jsx)(L.Z,{title:"\u9650\u5B9A\u5206\u7C7B\u53EF\u7528",open:m,onCancel:function(){t(!1)},onOk:function(){d(r()({},f)),t(!1)},children:(0,e.jsx)(c.Z,{children:(0,e.jsx)(c.Z.Item,{label:"\u5206\u7C7B",children:(0,e.jsx)(fe.Z,{multiple:!0,maxTagCount:10,treeDefaultExpandAll:!0,showSearch:!0,loading:u.loading,value:(Z=f.SupportedCategories)===null||Z===void 0?void 0:Z.map(function(v){return v.Id}),onChange:function(s){p(r()(r()({},f),{},{SupportedCategories:S.filter(function(I){return s.indexOf(I.key)>=0}).map(function(I){return I.raw_data})}))},treeData:a.map(function(v){return(0,te.iw)(v)})})})})})]})},ve=function(j){var i=j.rule,g=j.ok,Z=(0,o.useState)({}),D=l()(Z,2),d=D[0],x=D[1],E=(0,o.useState)(!1),f=l()(E,2),p=f[0],h=f[1];return(0,o.useEffect)(function(){x(r()({},i))},[i]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(A.ZP,{block:!0,onClick:function(){h(!0)},children:"\u8BA2\u5355\u6EE1\u51CF(".concat(i.LimitedOrderAmount||0,"\u5143)")}),(0,e.jsx)(L.Z,{title:"\u8BBE\u7F6E\u6EE1\u51CF\u91D1\u989D",open:p,onCancel:function(){h(!1)},onOk:function(){g(r()({},d)),h(!1)},children:(0,e.jsx)(c.Z,{children:(0,e.jsx)(c.Z.Item,{label:"\u6EE1\u51CF\u91D1\u989D",children:(0,e.jsx)(z.Z,{min:0,value:d.LimitedOrderAmount||0,onChange:function(m){x(r()(r()({},d),{},{LimitedOrderAmount:m||0}))}})})})})]})},he=n(38295),je=function(j){var i,g=j.rule,Z=j.ok,D=(0,o.useState)({}),d=l()(D,2),x=d[0],E=d[1],f=(0,o.useState)(!1),p=l()(f,2),h=p[0],C=p[1],m=(0,he.o)();return(0,o.useEffect)(function(){E(r()({},g))},[g]),(0,o.useEffect)(function(){h&&m.queryStores()},[h]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(A.ZP,{block:!0,onClick:function(){C(!0)},children:"\u9650\u5B9A\u95E8\u5E97(".concat(((i=g.SupportedStores)===null||i===void 0?void 0:i.map(function(t){return t.Name}).join(","))||"--",")")}),(0,e.jsx)(L.Z,{title:"\u9650\u5B9A\u95E8\u5E97\u53EF\u7528",open:h,onCancel:function(){C(!1)},onOk:function(){Z(r()({},x)),C(!1)},children:(0,e.jsx)(c.Z,{children:(0,e.jsx)(c.Z.Item,{label:"\u95E8\u5E97",children:(0,e.jsx)(ne.Z,{mode:"multiple",maxTagCount:100,onChange:function(u){E(r()(r()({},x),{},{SupportedStores:m.stores.filter(function(a){return u.indexOf(a.Id)>=0})}))},options:m.stores.map(function(t){return{label:t.Name,value:t.Id||""}})})})})})]})},ge=[{label:"\u8BA2\u5355\u6EE1\u51CF",key:"order-price"},{label:"\u7279\u5B9A\u95E8\u5E97",key:"store"},{label:"\u7279\u5B9A\u5546\u54C1\u5206\u7C7B",key:"goods-category"},{label:"\u7279\u5B9A\u5546\u54C1\u54C1\u724C",key:"goods-brand"},{label:"\u7279\u5B9A\u7528\u6237\u7B49\u7EA7",key:"user-grade",disabled:!0}],xe=function(j){var i=j.conditionList,g=j.ok,Z=j.disabled,D=function(x,E){var f=x.ValidatorType,p=(0,P.Jp)(x.RuleJson)||{},h=function(m){var t=r()(r()({},x),{},{RuleJson:JSON.stringify(m||{})}),u=Y()(i);u[E]=t,g(u)};return f=="order-price"?(0,e.jsx)(ve,{rule:p,ok:function(m){h(m)}}):f=="goods-brand"?(0,e.jsx)(ce,{rule:p,ok:function(m){h(m)}}):f=="goods-category"?(0,e.jsx)(me,{rule:p,ok:function(m){h(m)}}):f=="store"?(0,e.jsx)(je,{rule:p,ok:function(m){h(m)}}):(0,e.jsx)(A.ZP,{block:!0,danger:!0,type:"dashed",children:"\u65E0\u6548\u914D\u7F6E"})};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{style:{marginBottom:10},children:i.map(function(d,x){return(0,e.jsxs)(q.Z,{gutter:10,style:{marginBottom:10},children:[(0,e.jsx)(Q.Z,{flex:4,children:D(d,x)}),(0,e.jsx)(Q.Z,{flex:1,children:(0,e.jsx)(ie.Z,{title:"\u5220\u9664\u5F53\u524D\u6761\u4EF6",children:(0,e.jsx)(A.ZP,{block:!0,danger:!0,icon:(0,e.jsx)(de.Z,{stroke:1}),type:"dashed",onClick:function(){var f=Y()(i);(0,se.Z)(f,x),g(f)}})})})]},x)})}),(0,e.jsx)("div",{style:{},children:(0,e.jsx)(le.Z,{disabled:Z,menu:{items:ge.map(function(d){return{label:d.label,key:d.key,icon:d.icon,disabled:d.disabled,onClick:function(){if(i.some(function(h){return h.ValidatorType==d.key})){var E;(E=P.iI.message)===null||E===void 0||E.error("\u9650\u5B9A\u6761\u4EF6\u5DF2\u5B58\u5728");return}var f={ValidatorType:d.key},p=[].concat(Y()(i),[f]);g(p)}}})},children:(0,e.jsx)(A.ZP,{type:"dashed",block:!0,children:(0,e.jsx)(J.Z,{children:"\u6DFB\u52A0\u4F7F\u7528\u6761\u4EF6"})})})})]})},Ce=function(j){var i,g,Z=j.show,D=j.hide,d=j.data,x=j.ok,E=(0,o.useState)(!1),f=l()(E,2),p=f[0],h=f[1],C=(0,o.useState)({}),m=l()(C,2),t=m[0],u=m[1],a=(0,P.Wq)(t.Id),S=function(s){h(!0),k.x1.mallAdmin.couponSaveCoupon(r()({},s)).then(function(I){(0,P._y)(I,function(){X.ZP.success("\u4FDD\u5B58\u6210\u529F"),x()})}).finally(function(){h(!1)})};return(0,o.useEffect)(function(){u(d||{})},[d]),(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(L.Z,{title:"\u7F16\u8F91\u4F18\u60E0\u5238",open:Z,onCancel:function(){return D()},footer:(0,e.jsxs)(J.Z,{children:[(0,e.jsx)(ue.Z,{action:G()($()().mark(function v(){var s;return $()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,k.x1.mallAdmin.couponDelete({Id:d.Id});case 2:s=M.sent,(0,P._y)(s,function(){D(),x()});case 4:case"end":return M.stop()}},v)})),hide:(0,P.Wq)(d.Id)}),(0,e.jsx)(A.ZP,{type:"primary",onClick:function(){S(t)},children:"\u4FDD\u5B58"})]}),width:"90%",children:(0,e.jsx)(w.Z,{spinning:p,children:(0,e.jsx)(c.Z,{disabled:!a,onFinish:function(){return S(t)},labelCol:{flex:"110px"},labelAlign:"right",wrapperCol:{flex:1},children:(0,e.jsxs)(q.Z,{gutter:10,children:[(0,e.jsxs)(Q.Z,{span:12,children:[(0,e.jsx)(c.Z.Item,{label:"\u540D\u79F0",tooltip:"\u4F8B\u5982\u6EE1100\u51CF10",children:(0,e.jsx)(ee.Z,{maxLength:30,required:!0,value:t.Name||"",onChange:function(s){u(r()(r()({},t),{},{Name:s.target.value}))}})}),(0,e.jsx)(c.Z.Item,{label:"\u63CF\u8FF0",name:"Description",children:(0,e.jsx)(ee.Z.TextArea,{maxLength:100,value:t.Description||"",onChange:function(s){u(r()(r()({},t),{},{Description:s.target.value}))}})}),(0,e.jsx)(c.Z.Item,{label:"\u91D1\u989D",tooltip:"\u4F18\u60E0\u5238\u91D1\u989D",children:(0,e.jsx)(z.Z,{required:!0,min:0,value:t.Price||0,onChange:function(s){u(r()(r()({},t),{},{Price:s||0}))}})}),(0,e.jsx)(c.Z.Item,{label:"\u6570\u91CF",tooltip:"\u53D1\u884C\u6570\u91CF",children:(0,e.jsx)(z.Z,{min:0,required:!0,value:t.Amount,onChange:function(s){u(r()(r()({},t),{},{Amount:s||0}))}})}),(0,e.jsx)(c.Z.Item,{label:"\u65F6\u95F4\u8303\u56F4",children:(0,e.jsx)(re.default.RangePicker,{allowClear:!0,value:[((i=(0,R.mg)(t.StartTime))===null||i===void 0?void 0:i.add(R.Mg,"hour"))||null,((g=(0,R.mg)(t.EndTime))===null||g===void 0?void 0:g.add(R.Mg,"hour"))||null],onChange:function(s){var I,M;u(r()(r()({},t),{},{StartTime:s==null||(I=s.at(0))===null||I===void 0?void 0:I.add(-R.Mg,"hours").format(R.dq),EndTime:s==null||(M=s.at(1))===null||M===void 0?void 0:M.add(-R.Mg,"hours").format(R.dq)}))}})}),(0,e.jsx)(c.Z.Item,{label:"\u9886\u53D6\u6B21\u6570",tooltip:"\u6BCF\u4E2A\u8D26\u53F7\u53EF\u4EE5\u9886\u53D6\u591A\u5C11\u6B21",children:(0,e.jsx)(z.Z,{value:t.AccountIssuedLimitCount||0,onChange:function(s){u(r()(r()({},t),{},{AccountIssuedLimitCount:s||0}))}})}),(0,e.jsx)(c.Z.Item,{label:"\u6709\u6548\u671F",tooltip:"\u9886\u53D6\u540E\u591A\u5C11\u5929\u6709\u6548",children:(0,e.jsx)(z.Z,{value:t.ExpiredInDays||0,onChange:function(s){u(r()(r()({},t),{},{ExpiredInDays:s||0}))}})}),(0,e.jsx)(c.Z.Item,{label:"\u72B6\u6001\u53EF\u7528",children:(0,e.jsx)(ae.Z,{checked:t.IsActive,onChange:function(s){u(r()(r()({},t),{},{IsActive:s}))}})})]}),(0,e.jsx)(Q.Z,{span:12,children:(0,e.jsx)(c.Z.Item,{label:"\u4F7F\u7528\u6761\u4EF6",name:"OrderConditionRulesJson",children:(0,e.jsx)(xe,{disabled:!a,conditionList:(0,P.Jp)(t.OrderConditionRulesJson)||[],ok:function(s){console.log("rules-changed",s),u(r()(r()({},t),{},{OrderConditionRulesJson:JSON.stringify(s||[])}))}})})})]})})})})})},pe=function(){var j,i=(0,F.Z)(k.x1.mallAdmin.couponQueryCouponPaging,{manual:!0,onSuccess:function(u,a){(0,P._y)(u,function(){})}}),g=((j=i.data)===null||j===void 0?void 0:j.data)||{},Z=(0,o.useState)({Page:1}),D=l()(Z,2),d=D[0],x=D[1],E=(0,o.useState)(void 0),f=l()(E,2),p=f[0],h=f[1],C=function(){i.run(r()({},d))},m=[{title:"\u540D\u79F0",render:function(u,a){return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:a.Name||"--"}),(0,P.Wq)(a.Description)||(0,e.jsx)("p",{children:a.Description})]})}},{title:"\u91D1\u989D",render:function(u,a){return(0,e.jsx)(T.Z,{color:"warning",children:(0,e.jsx)("b",{children:(0,P.lb)(a.Price||0)})})}},{title:"\u6570\u91CF",render:function(u,a){return a.Amount||0}},{title:"\u9886\u53D6\u9650\u5236",render:function(u,a){return a.AccountIssuedLimitCount?(0,e.jsx)("b",{children:a.AccountIssuedLimitCount}):null}},{title:"\u9886\u53D6\u540E\u6709\u6548\u671F",render:function(u,a){return a.ExpiredInDays?(0,e.jsx)("b",{children:"".concat(a.ExpiredInDays,"\u5929")}):null}},{title:"\u65F6\u95F4\u8303\u56F4",render:function(u,a){return(0,e.jsxs)(e.Fragment,{children:[a.StartTime&&a.StartTime.length>0&&(0,e.jsxs)("div",{children:["\u5F00\u59CB\u65F6\u95F4\uFF1A",(0,e.jsx)(W.Z,{timeStr:a.StartTime})]}),a.EndTime&&a.EndTime.length>0&&(0,e.jsxs)("div",{children:["\u7ED3\u675F\u65F6\u95F4\uFF1A",(0,e.jsx)(W.Z,{timeStr:a.EndTime})]})]})}},{title:"\u9886\u53D6\u6570\u91CF",render:function(u,a){return a.IssuedAmount||0}},{title:"\u4F7F\u7528\u6570\u91CF",render:function(u,a){return a.UsedAmount||0}},{title:"\u72B6\u6001",render:function(u,a){return a.IsActive?(0,e.jsx)(B.Z,{text:"\u53EF\u7528",status:"success"}):(0,e.jsx)(B.Z,{text:"\u4E0D\u53EF\u7528",status:"error"})}},{title:"\u65F6\u95F4",render:function(u,a){return(0,e.jsx)(U.Z,{model:a})}},{title:"\u64CD\u4F5C",width:200,render:function(u,a){return(0,e.jsx)(A.ZP.Group,{children:(0,e.jsx)(A.ZP,{type:"link",onClick:function(){h(a)},children:"\u7F16\u8F91"})})}}];return(0,o.useEffect)(function(){C()},[d]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Ce,{show:p!=null,hide:function(){return h(void 0)},data:p||{},ok:function(){h(void 0),C()}}),(0,e.jsx)(N.Z,{title:"\u4F18\u60E0\u5238",extra:(0,e.jsx)(A.ZP,{type:"primary",onClick:function(){h({})},children:"\u65B0\u589E"}),children:(0,e.jsx)(b.Z,{loading:i.loading,columns:m,dataSource:g.Items||[],pagination:{showSizeChanger:!1,pageSize:20,current:d.Page,total:g.TotalCount,onChange:function(u){x(r()(r()({},d),{},{Page:u}))}}})})]})}}}]);
